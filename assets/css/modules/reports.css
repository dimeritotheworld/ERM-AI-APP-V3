/**
 * Risk Reporting Hub Styles
 * Styling for report templates, recent reports, scheduled reports
 * Version: 7.3.0
 * Changes: Fixed page overflow - enforced A4 page boundaries (297mm) with max-height constraints
 */

/* ========================================
   PAGE HEADER OVERRIDE FOR REPORTS
   ======================================== */

#view-reports .page-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 32px;
  gap: 20px;
}

#view-reports .page-header-content {
  flex: 1;
}

#view-reports .page-header-actions {
  flex-shrink: 0;
}

#view-reports .page-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--text-primary, #0f172a);
  margin: 0 0 6px 0;
}

#view-reports .page-subtitle {
  font-size: 14px;
  color: var(--text-secondary, #64748b);
  margin: 0;
}

/* ========================================
   AI REPORT BUILDER
   ======================================== */

.ai-report-builder {
  padding: 8px 0;
}

.ai-prompt-suggestions {
  margin-top: 16px;
}

.suggestions-label {
  font-size: 12px;
  color: #64748b;
  margin: 0 0 10px 0;
  font-weight: 500;
}

.suggestion-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.suggestion-chip {
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 20px;
  padding: 6px 14px;
  font-size: 12px;
  color: #475569;
  cursor: pointer;
  transition: all 0.15s ease;
}

.suggestion-chip:hover {
  background: #e0e7ff;
  border-color: #c7d2fe;
  color: #3730a3;
}

/* Loading spinner for AI generation */
.loading-spinner {
  display: inline-block;
  width: 14px;
  height: 14px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 0.8s linear infinite;
  vertical-align: middle;
  margin-right: 6px;
}

/* @keyframes spin moved to core/components.css */

/* Button disabled state during AI generation */
.btn-primary:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

/* ========================================
   TEMPLATE SELECT LIST
   ======================================== */

.template-select-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.template-select-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 16px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.template-select-item:hover {
  background: var(--blue-50);
  border-color: #bfdbfe;
}

.template-select-icon {
  font-size: 28px;
  line-height: 1;
}

.template-select-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.template-select-info strong {
  font-size: 14px;
  color: #0f172a;
}

.template-select-meta {
  font-size: 12px;
  color: #64748b;
}

/* ========================================
   REPORTS CONTENT AREA (Windows Explorer Style)
   ======================================== */

.reports-content-area {
  background: transparent;
  overflow: visible;
}

/* Toolbar */
.reports-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  margin-bottom: 16px;
}

.toolbar-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Search box */
.toolbar-search {
  position: relative;
  display: flex;
  align-items: center;
}

.toolbar-search .search-icon {
  position: absolute;
  left: 12px;
  color: #94a3b8;
  pointer-events: none;
}

.toolbar-search .search-input {
  width: 220px;
  padding: 8px 12px 8px 36px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 13px;
  color: #0f172a;
  background: white;
  transition: all 0.15s ease;
}

.toolbar-search .search-input:focus {
  outline: none;
  border-color: #c41e3a;
  box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.1);
}

.toolbar-search .search-input::placeholder {
  color: #94a3b8;
}

/* Filter dropdown */
.toolbar-filter .filter-select {
  padding: 8px 32px 8px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 13px;
  color: #0f172a;
  background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") no-repeat right 10px center;
  appearance: none;
  cursor: pointer;
  transition: all 0.15s ease;
}

.toolbar-filter .filter-select:focus {
  outline: none;
  border-color: #c41e3a;
  box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.1);
}

.reports-count {
  font-size: 13px;
  color: #64748b;
  padding-left: 12px;
  border-left: 1px solid #e2e8f0;
}

.toolbar-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.view-toggle {
  display: flex;
  background: #e2e8f0;
  border-radius: 6px;
  padding: 2px;
}

.view-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 28px;
  border: none;
  background: transparent;
  border-radius: 4px;
  cursor: pointer;
  color: #64748b;
  transition: all 0.15s ease;
}

.view-btn:hover {
  color: #334155;
}

.view-btn.active {
  background: white;
  color: #0f172a;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Reports Container - defaults to list view (like risk register list) */
.reports-grid {
  display: flex;
  flex-direction: column;
  gap: 12px;
  /* No min-height: let content determine height (empty state has its own min-height)
     No margin-top: spacing provided by info-banner margin-bottom (16px) */
  background: transparent;
  overflow: visible;
  position: relative;
}

/* Report Card Icon Header - hidden in list view */
.report-card-icon-header {
  display: none;
}

/* Report Card Body */
.report-card-body {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
}

/* ========================================
   GRID VIEW
   ======================================== */
.reports-grid.grid-view {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
  background: transparent;
}

.reports-grid.grid-view .report-card {
  flex-direction: column;
  padding: 0;
  overflow: visible;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  background: white;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
  transition: all 0.2s ease;
  position: relative;
}

.reports-grid.grid-view .report-card:hover {
  border-color: #cbd5e1;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
  transform: translateY(-2px);
}

.reports-grid.grid-view .report-card.dropdown-active {
  border-color: #c41e3a;
  box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.1);
  transform: none;
}

/* Grid: Show icon header */
.reports-grid.grid-view .report-card-icon-header {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 32px 20px 24px;
  background: linear-gradient(145deg, #f8fafc 0%, #f1f5f9 100%);
  border-bottom: 1px solid #e2e8f0;
  border-radius: 12px 12px 0 0;
}

.reports-grid.grid-view .report-icon-large {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 72px;
  height: 72px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.reports-grid.grid-view .report-icon-large svg {
  width: 48px;
  height: 48px;
}

/* Grid: Card body */
.reports-grid.grid-view .report-card-body {
  flex-direction: column;
  align-items: stretch;
  padding: 16px;
  gap: 12px;
}

.reports-grid.grid-view .report-card-left {
  flex-direction: column;
  align-items: flex-start;
  gap: 0;
}

/* Grid: Hide small icon */
.reports-grid.grid-view .report-icon {
  display: none;
}

.reports-grid.grid-view .report-info {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  width: 100%;
  min-width: 0;
  text-align: left;
}

.reports-grid.grid-view .report-card-title {
  display: block;
  width: 100%;
  font-size: 14px;
  font-weight: 600;
  color: #111827;
  margin: 0 0 4px 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: left;
}

.reports-grid.grid-view .report-card-meta {
  display: block;
  width: 100%;
  font-size: 12px;
  color: #64748b;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: left;
}

.reports-grid.grid-view .meta-dot {
  color: #cbd5e1;
}

.reports-grid.grid-view .meta-format {
  font-weight: 600;
  color: #475569;
}

.reports-grid.grid-view .meta-date {
  color: #64748b;
}

.reports-grid.grid-view .meta-author {
  color: #64748b;
}

.reports-grid.grid-view .report-card-actions {
  width: 100%;
  justify-content: flex-end;
  padding-top: 12px;
  border-top: 1px solid #f1f5f9;
}

/* Report Card - Base styles */
.report-card {
  display: flex;
  flex-direction: column;
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 16px 20px;
  cursor: pointer;
  transition: all 0.2s ease;
  overflow: visible;
  position: relative;
}

.report-card:hover {
  border-color: #d1d5db;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.report-card.selected {
  border-color: #c41e3a;
  box-shadow: 0 0 0 2px rgba(196, 30, 58, 0.1);
}

.report-card.dropdown-active {
  border-color: #c41e3a;
  box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.1);
}

/* Report Card Checkbox */
.report-card-checkbox {
  position: absolute;
  top: 12px;
  left: 12px;
  z-index: 1;
}

.reports-grid.grid-view .report-card-checkbox {
  top: 12px;
  left: 12px;
}

.reports-grid.grid-view .report-card-icon-header {
  padding-left: 28px;
}

/* List view: meta styling */
.reports-grid:not(.grid-view) .meta-dot {
  color: #cbd5e1;
}

.reports-grid:not(.grid-view) .meta-author {
  color: #64748b;
}

.report-card-left {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
  min-width: 0;
}

.report-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  flex-shrink: 0;
}

/* Large icon (for grid view header) */
.report-icon-large {
  display: none;
}

.report-icon svg {
  width: 20px;
  height: 20px;
}

.report-info {
  flex: 1;
  min-width: 0;
}

.report-card-title {
  font-size: 16px;
  font-weight: 600;
  color: #111827;
  margin: 0 0 4px 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.report-card-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: #6b7280;
  flex-wrap: wrap;
}

.meta-format {
  font-weight: 600;
  color: #475569;
  font-size: 12px;
}

.meta-dot {
  color: #cbd5e1;
  font-size: 10px;
}

.meta-date {
  color: #64748b;
}

.meta-author {
  color: #64748b;
}

.report-card-actions {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

/* Reports list container */
.reports-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* ========================================
   REPORTS EMPTY STATE
   MOVED TO core/components.css as .module-empty-state (Canonical)
   Use class="module-empty-state" in HTML
   All modules use components.css .module-empty-state as single source
   ======================================== */

/* Reports-specific: span full grid width */
.reports-grid .module-empty-state {
  grid-column: 1 / -1;
}

/* ========================================
   REPORT SECTIONS (Legacy)
   ======================================== */

.report-section {
  margin-bottom: 36px;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.section-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary, #0f172a);
  margin: 0;
}

/* ========================================
   EMPTY STATE CARD
   ======================================== */

.empty-state-card {
  background: white;
  border: 2px dashed #cbd5e1;
  border-radius: 16px;
  padding: 60px 40px;
  text-align: center;
  max-width: 500px;
  margin: 0 auto;
}

.empty-state-card .empty-state-icon {
  font-size: 56px;
  margin-bottom: 16px;
}

.empty-state-card h3 {
  font-size: 18px;
  font-weight: 600;
  color: #0f172a;
  margin: 0 0 8px 0;
}

.empty-state-card p {
  font-size: 14px;
  color: #64748b;
  margin: 0 0 28px 0;
  max-width: 360px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.6;
}

.empty-state-card .btn {
  padding: 12px 28px;
  font-size: 15px;
  font-weight: 600;
}

/* ========================================
   TEMPLATE CARDS GRID
   ======================================== */

.templates-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 20px;
}

.template-card {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 0;
  transition: all 0.2s ease;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.template-card:hover {
  border-color: #cbd5e1;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
  transform: translateY(-2px);
}

.template-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 20px 20px 0 20px;
}

.template-icon {
  font-size: 36px;
  line-height: 1;
}

.template-actions {
  display: flex;
  gap: 4px;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.template-card:hover .template-actions {
  opacity: 1;
}

.template-card-content {
  padding: 12px 20px 16px;
  flex: 1;
}

.template-card-title {
  font-size: 16px;
  font-weight: 600;
  color: #0f172a;
  margin: 0 0 6px 0;
  line-height: 1.3;
}

.template-card-desc {
  font-size: 13px;
  color: #64748b;
  line-height: 1.5;
  margin: 0 0 12px 0;
}

.template-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 12px;
}

.template-meta .meta-item {
  font-size: 11px;
  color: #64748b;
}

.template-sections {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.section-badge {
  display: inline-block;
  background: #f1f5f9;
  color: #475569;
  font-size: 10px;
  font-weight: 500;
  padding: 3px 8px;
  border-radius: 12px;
}

.template-generate-btn {
  margin: 0 16px 16px 16px;
  width: calc(100% - 32px);
}

/* ========================================
   RECENT REPORTS LIST
   ======================================== */

.recent-reports-list {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.recent-report-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 20px;
  border-bottom: 1px solid #f1f5f9;
  transition: background 0.15s ease;
}

.recent-report-row:last-child {
  border-bottom: none;
}

.recent-report-row:hover {
  background: #f8fafc;
}

.report-info {
  display: flex;
  align-items: center;
  gap: 14px;
  flex: 1;
  min-width: 0;
}

.report-icon {
  font-size: 28px;
  flex-shrink: 0;
}

.report-details {
  flex: 1;
  min-width: 0;
}

.report-name {
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
  margin: 0 0 4px 0;
}

.report-meta-row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.meta-text {
  font-size: 12px;
  color: #64748b;
}

.report-actions {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
}

/* ========================================
   SCHEDULED REPORTS GRID
   ======================================== */

.scheduled-reports-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
}

.scheduled-report-card {
  background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
  border-radius: 12px;
  padding: 20px;
  color: white;
}

.scheduled-report-card.paused {
  background: linear-gradient(135deg, #475569 0%, #334155 100%);
  opacity: 0.85;
}

.schedule-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 14px;
}

.schedule-name {
  font-size: 15px;
  font-weight: 600;
  margin: 0;
  color: white;
}

.schedule-status {
  font-size: 11px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 4px;
}

.schedule-details {
  margin-bottom: 14px;
}

.schedule-row {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 6px;
}

.schedule-row:last-child {
  margin-bottom: 0;
}

.schedule-label {
  font-weight: 600;
  color: rgba(255, 255, 255, 0.6);
  margin-right: 6px;
}

.schedule-actions {
  display: flex;
  gap: 8px;
  padding-top: 14px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.schedule-actions .btn {
  flex: 1;
  font-size: 12px;
  padding: 6px 10px;
}

/* ========================================
   EMPTY STATES INLINE
   ======================================== */

.empty-state-inline {
  background: #f8fafc;
  border: 1px dashed #cbd5e1;
  border-radius: 12px;
  padding: 24px;
  text-align: center;
}

.empty-state-inline p {
  margin: 0;
  color: #64748b;
  font-size: 13px;
}

/* ========================================
   REPORT BUILDER
   ======================================== */

.report-builder {
  padding: 8px 0;
}

.builder-config {
  max-width: 100%;
}

.checkbox-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 12px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
}

.checkbox-item {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  font-size: 13px;
  color: #374151;
}

.checkbox-item input[type="checkbox"] {
  width: 16px;
  height: 16px;
  accent-color: var(--ai-accent);
}

/* ========================================
   FORM ROW - MOVED TO core/components.css (Canonical)
   Removed: .form-row, .form-row .form-group
   ~8 lines removed
   ======================================== */

/* ========================================
   BUTTON VARIANTS
   MOVED TO core/components.css (Canonical)
   Removed: .btn-sm, .btn-danger-outline, .btn-icon, .btn-icon-danger
   ~44 lines removed - use components.css as single source
   ======================================== */

/* ========================================
   RESPONSIVE
   ======================================== */

@media (max-width: 768px) {
  .templates-grid {
    grid-template-columns: 1fr;
  }

  .scheduled-reports-grid {
    grid-template-columns: 1fr;
  }

  .recent-report-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .report-actions {
    width: 100%;
  }

  .report-actions .btn {
    flex: 1;
  }

  .section-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  /* .form-row responsive handled in core/components.css */

  .report-meta-row {
    flex-direction: column;
    gap: 4px;
  }

  .template-actions {
    opacity: 1;
  }
}

/* ========================================
   DARK THEME SUPPORT
   ======================================== */

/* Reports Content Area - Dark Mode */
html.theme-dark .reports-content-area {
  background: transparent;
}

html.theme-dark .reports-toolbar {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .reports-count {
  color: var(--text-secondary);
}

html.theme-dark .view-toggle {
  background: var(--bg-secondary);
}

html.theme-dark .view-btn {
  color: var(--text-muted);
}

html.theme-dark .view-btn:hover {
  color: var(--text-secondary);
}

html.theme-dark .view-btn.active {
  background: var(--card-bg);
  color: var(--text-primary);
}

html.theme-dark .reports-grid {
  background: transparent;
}

html.theme-dark .report-card {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .report-card:hover {
  border-color: var(--border-hover);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

html.theme-dark .report-card.dropdown-active {
  border-color: #c41e3a;
  box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.2);
}

html.theme-dark .reports-grid.grid-view .report-card-icon-header {
  background: linear-gradient(145deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
  border-bottom-color: var(--border-color);
}

html.theme-dark .reports-grid.grid-view .report-icon-large {
  background: var(--card-bg);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

html.theme-dark .reports-grid.grid-view .report-card-body {
  background: var(--card-bg);
}

html.theme-dark .reports-grid.grid-view .report-card-actions {
  border-top-color: var(--border-color);
}

html.theme-dark .reports-grid.grid-view .meta-format {
  background: var(--bg-secondary);
}

html.theme-dark .report-icon {
  background: var(--bg-secondary);
  border-color: var(--border-color);
}

html.theme-dark .card-action-btn {
  background: var(--card-bg);
  color: var(--text-secondary);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

html.theme-dark .card-action-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

html.theme-dark .card-action-btn.card-action-danger:hover {
  background: rgba(220, 38, 38, 0.15);
  color: #f87171;
}

html.theme-dark .report-card-title {
  color: var(--text-primary);
}

html.theme-dark .meta-format {
  color: var(--text-secondary);
}

html.theme-dark .meta-dot {
  color: var(--border-color);
}

html.theme-dark .meta-date,
html.theme-dark .meta-author {
  color: var(--text-muted);
}

html.theme-dark .meta-date {
  color: var(--text-muted);
}

html.theme-dark .toolbar-search .search-input {
  background: var(--bg-secondary);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .toolbar-search .search-input:focus {
  border-color: #c41e3a;
}

html.theme-dark .toolbar-search .search-icon {
  color: var(--text-muted);
}

html.theme-dark .toolbar-filter .filter-select {
  background-color: var(--bg-secondary);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .toolbar-filter .filter-select:focus {
  border-color: #c41e3a;
}

html.theme-dark .reports-count {
  border-left-color: var(--border-color);
}

/* Dark mode empty state: uses .module-empty-state from components.css */
html.theme-dark .module-empty-state .empty-illustration svg rect[fill="#f1f5f9"] {
  fill: var(--bg-tertiary);
}

html.theme-dark .module-empty-state .empty-illustration svg rect[stroke="#e2e8f0"] {
  stroke: var(--border-color);
}

html.theme-dark .reports-grid.list-view .report-card {
  border-bottom-color: var(--border-color);
}

html.theme-dark .section-title {
  color: var(--text-primary);
}

html.theme-dark .empty-state-card {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .empty-state-card h3 {
  color: var(--text-primary);
}

html.theme-dark .empty-state-card p {
  color: var(--text-secondary);
}

html.theme-dark .template-card {
  background: var(--card-bg);
  border-color: var(--card-border);
}

html.theme-dark .template-card:hover {
  border-color: var(--border-light);
}

html.theme-dark .template-card-title {
  color: var(--text-primary);
}

html.theme-dark .template-card-desc {
  color: var(--text-secondary);
}

html.theme-dark .template-meta .meta-item {
  color: var(--text-muted);
}

html.theme-dark .section-badge {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
}

html.theme-dark .recent-reports-list {
  background: var(--card-bg);
  border-color: var(--card-border);
}

html.theme-dark .recent-report-row {
  border-bottom-color: var(--border-color);
}

html.theme-dark .recent-report-row:hover {
  background: var(--bg-hover);
}

html.theme-dark .report-name {
  color: var(--text-primary);
}

html.theme-dark .meta-text {
  color: var(--text-secondary);
}

html.theme-dark .empty-state-inline {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .empty-state-inline p {
  color: var(--text-secondary);
}

html.theme-dark .checkbox-group {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .checkbox-item {
  color: var(--text-primary);
}

html.theme-dark .btn-icon {
  color: var(--text-secondary);
}

html.theme-dark .btn-icon:hover {
  background: var(--bg-hover);
  color: var(--ai-accent);
}

html.theme-dark .btn-icon-danger:hover {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
}

html.theme-dark .btn-danger-outline {
  border-color: rgba(239, 68, 68, 0.3);
  color: #f87171;
}

html.theme-dark .btn-danger-outline:hover {
  background: rgba(239, 68, 68, 0.1);
}

/* Dark theme - AI Report Builder */
html.theme-dark .suggestion-chip {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
  color: var(--text-secondary);
}

html.theme-dark .suggestion-chip:hover {
  background: rgba(59, 130, 246, 0.15);
  border-color: rgba(59, 130, 246, 0.3);
  color: #60a5fa;
}

/* Dark theme - Template Select List */
html.theme-dark .template-select-item {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .template-select-item:hover {
  background: rgba(59, 130, 246, 0.1);
  border-color: rgba(59, 130, 246, 0.3);
}

html.theme-dark .template-select-info strong {
  color: var(--text-primary);
}

html.theme-dark .template-select-meta {
  color: var(--text-muted);
}

html.theme-dark .suggestions-label {
  color: var(--text-muted);
}

/* ========================================
   REPORT BUILDER WIZARD
   ======================================== */

.report-builder-wizard {
  padding: 0;
}

.builder-step-content {
  width: 100%;
}

/* Progress Bar */
.builder-progress {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 28px;
  padding: 0 10px;
}

.progress-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  position: relative;
}

.progress-step:not(:last-child)::after {
  content: '';
  position: absolute;
  top: 16px;
  left: calc(50% + 20px);
  width: calc(100% - 40px);
  height: 2px;
  background: #e2e8f0;
  z-index: 0;
}

.progress-step.completed:not(:last-child)::after {
  background: var(--ai-accent);
}

.step-number {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #f1f5f9;
  border: 2px solid #e2e8f0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  font-weight: 600;
  color: #64748b;
  position: relative;
  z-index: 1;
  transition: all 0.2s ease;
}

.progress-step.active .step-number {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
}

.progress-step.completed .step-number {
  background: #22c55e;
  border-color: #22c55e;
  color: white;
}

.step-label {
  margin-top: 8px;
  font-size: 11px;
  color: #64748b;
  font-weight: 500;
  text-align: center;
}

.progress-step.active .step-label {
  color: var(--ai-accent);
  font-weight: 600;
}

.progress-step.completed .step-label {
  color: #22c55e;
}

/* Step Content */
.builder-step {
  display: none;
}

.builder-step.active {
  display: block;
}

/* Override for Step 4 side-by-side layout */
.builder-step.builder-step-editor.active {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  min-height: 500px;
}

.step-title {
  font-size: 18px;
  font-weight: 600;
  color: #0f172a;
  margin: 0 0 6px 0;
}

.step-description {
  font-size: 13px;
  color: #64748b;
  margin: 0 0 20px 0;
}

/* Data Source Cards */
.data-source-grid,
.data-sources-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 20px;
}

.data-source-card {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 14px 16px;
  background: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.source-icon {
  font-size: 28px;
  line-height: 1;
}

.source-info {
  flex: 1;
}

.source-info h4 {
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
  margin: 0 0 4px 0;
}

.source-info p {
  font-size: 12px;
  color: #64748b;
  margin: 0;
  line-height: 1.4;
}

.source-checkbox {
  display: flex;
  align-items: center;
}

.source-checkbox input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: var(--ai-accent);
}

.quick-select-row {
  display: flex;
  gap: 8px;
  margin-top: 16px;
}

.data-source-card:hover {
  border-color: #bfdbfe;
  background: #f0f9ff;
}

.data-source-card.selected {
  border-color: var(--ai-accent);
  background: var(--blue-50);
}

.data-source-card input[type="checkbox"] {
  margin-top: 2px;
  width: 18px;
  height: 18px;
  accent-color: var(--ai-accent);
}

.data-source-icon {
  font-size: 24px;
  line-height: 1;
}

.data-source-info {
  flex: 1;
}

.data-source-name {
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
  margin-bottom: 2px;
}

.data-source-desc {
  font-size: 12px;
  color: #64748b;
  line-height: 1.4;
}

/* Filter Grid */
.filter-grid,
.filters-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
}

.filter-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* Filter Preview Stats */
.filter-preview {
  display: flex;
  gap: 24px;
  margin-top: 24px;
  padding: 16px;
  background: #f8fafc;
  border-radius: 10px;
}

.preview-stat {
  display: flex;
  align-items: center;
  gap: 10px;
}

.stat-icon {
  font-size: 20px;
}

.stat-value {
  font-size: 24px;
  font-weight: 700;
  color: #0f172a;
}

.stat-label {
  font-size: 12px;
  color: #64748b;
}

.filter-label {
  font-size: 12px;
  font-weight: 600;
  color: #374151;
}

.filter-select {
  padding: 10px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 13px;
  color: #334155;
  background: white;
  cursor: pointer;
}

.filter-select:focus {
  outline: none;
  border-color: var(--ai-accent);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Section Selection */
.sections-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: 320px;
  overflow-y: auto;
  padding-right: 8px;
}

.section-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.section-item:hover {
  background: #f0f9ff;
  border-color: #bfdbfe;
}

.section-item.selected {
  background: var(--blue-50);
  border-color: var(--ai-accent);
}

.section-item input[type="checkbox"] {
  width: 16px;
  height: 16px;
  accent-color: var(--ai-accent);
}

.section-icon {
  font-size: 20px;
  line-height: 1;
}

.section-info {
  flex: 1;
}

.section-name {
  font-size: 13px;
  font-weight: 600;
  color: #0f172a;
}

.section-desc {
  font-size: 11px;
  color: #64748b;
}

.section-actions {
  display: flex;
  gap: 4px;
  opacity: 0;
  transition: opacity 0.15s ease;
}

.section-item:hover .section-actions {
  opacity: 1;
}

.section-drag-handle {
  cursor: grab;
  color: #94a3b8;
  font-size: 14px;
  padding: 4px;
}

.section-drag-handle:hover {
  color: #64748b;
}

.section-checkbox {
  display: flex;
  align-items: center;
}

.section-info h4 {
  font-size: 13px;
  font-weight: 600;
  color: #0f172a;
  margin: 0 0 2px 0;
}

.section-info p {
  font-size: 11px;
  color: #64748b;
  margin: 0;
}

/* Add Custom Section */
.add-custom-section {
  margin-top: 16px;
}

.no-sections-warning {
  background: #fef3c7;
  border: 1px solid #fde68a;
  border-radius: 8px;
  padding: 16px;
  text-align: center;
}

.no-sections-warning p {
  margin: 0;
  color: #92400e;
  font-size: 14px;
}

/* Preview Panel */
.preview-panel {
  display: flex;
  gap: 20px;
  min-height: 400px;
}

.preview-main {
  flex: 1;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: white;
  border-bottom: 1px solid #e2e8f0;
}

.preview-title {
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
  margin: 0;
}

.preview-actions {
  display: flex;
  gap: 8px;
}

.preview-content {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
  background: white;
}

.preview-iframe {
  width: 100%;
  min-height: 350px;
  border: none;
  background: white;
}

/* AI Sidebar */
.ai-sidebar {
  width: 280px;
  background: linear-gradient(135deg, var(--blue-900) 0%, var(--blue-500) 100%);
  border-radius: 12px;
  padding: 20px;
  color: white;
  display: flex;
  flex-direction: column;
}

.ai-sidebar-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
}

.ai-sidebar-icon {
  font-size: 24px;
}

.ai-sidebar-title {
  font-size: 16px;
  font-weight: 600;
  margin: 0;
}

.ai-sidebar-desc {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.85);
  line-height: 1.5;
  margin-bottom: 16px;
}

.ai-suggestions {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.ai-suggestion-btn {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 12px;
  color: white;
  text-align: left;
  cursor: pointer;
  transition: all 0.15s ease;
}

.ai-suggestion-btn:hover {
  background: rgba(255, 255, 255, 0.25);
  border-color: rgba(255, 255, 255, 0.4);
}

/* Step 4 Editor & Preview Side-by-Side Layout */
.builder-step-editor .editor-panel {
  display: flex;
  flex-direction: column;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  overflow: hidden;
  min-height: 450px;
  max-height: 500px;
}

.builder-step-editor .editor-header {
  padding: 12px 16px;
  background: white;
  border-bottom: 1px solid #e2e8f0;
}

.builder-step-editor .editor-header h4 {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
}

.editor-section-tabs {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  padding: 12px;
  background: white;
  border-bottom: 1px solid #e2e8f0;
}

.editor-tab {
  padding: 6px 12px;
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 12px;
  color: #475569;
  cursor: pointer;
  transition: all 0.15s ease;
}

.editor-tab:hover {
  background: #e2e8f0;
}

.editor-tab.active {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
}

.editor-content {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.section-editor {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.editor-toolbar {
  display: flex;
  gap: 4px;
  padding: 8px 12px;
  background: white;
  border-bottom: 1px solid #e2e8f0;
}

.editor-btn {
  padding: 6px 10px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.editor-btn:hover {
  background: #e2e8f0;
}

.toolbar-sep {
  width: 1px;
  background: #e2e8f0;
  margin: 0 4px;
}

.editor-area {
  flex: 1;
  min-height: 200px;
  padding: 16px;
  background: white;
  font-size: 14px;
  line-height: 1.6;
  overflow-y: auto;
  border: none;
}

.editor-area:focus {
  outline: none;
  box-shadow: inset 0 0 0 2px rgba(59, 130, 246, 0.2);
}

.builder-step-editor .preview-panel {
  display: flex;
  flex-direction: column;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  overflow: hidden;
  min-height: 450px;
  max-height: 500px;
}

.builder-step-editor .preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: #f8fafc;
  border-bottom: 1px solid #e2e8f0;
}

.builder-step-editor .preview-header h4 {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
}

.builder-step-editor .preview-frame {
  flex: 1;
  overflow-y: auto;
  background: white;
}

/* Preview Sections */
.preview-section {
  padding: 16px 20px;
  border-bottom: 1px solid #f1f5f9;
}

.preview-section:last-child {
  border-bottom: none;
}

.preview-section h3 {
  font-size: 14px;
  font-weight: 600;
  color: #1e293b;
  margin: 0 0 10px 0;
  padding-bottom: 6px;
  border-bottom: 1px solid #e2e8f0;
}

.preview-section-content {
  font-size: 13px;
  color: #475569;
  line-height: 1.6;
}

.preview-section-content p {
  margin: 8px 0;
}

.preview-section-content ul,
.preview-section-content ol {
  margin: 8px 0;
  padding-left: 20px;
}

.preview-section-content li {
  margin: 4px 0;
}

/* Step 4 Preview Layout (legacy) */
.builder-step-preview {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 24px;
}

.preview-config {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 20px;
}

.preview-config .step-title {
  margin-bottom: 20px;
}

.preview-frame {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  min-height: 300px;
  overflow: auto;
}

.preview-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 200px;
  color: #64748b;
  font-size: 14px;
}

.format-options {
  display: flex;
  gap: 12px;
}

.format-option {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 14px;
  background: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
  position: relative;
}

.format-option:hover {
  border-color: #bfdbfe;
  background: #f0f9ff;
}

.format-option.selected {
  border-color: var(--ai-accent);
  background: var(--blue-50);
}

.format-option.disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.format-icon {
  font-size: 24px;
}

.format-label {
  font-size: 12px;
  font-weight: 600;
  color: #334155;
}

.upgrade-badge {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: white;
  font-size: 9px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 8px;
  text-transform: uppercase;
  position: absolute;
  top: -6px;
  right: -6px;
}

.email-input-wrapper {
  position: relative;
}

.email-input-wrapper .upgrade-badge {
  position: absolute;
  top: 50%;
  right: 10px;
  transform: translateY(-50%);
}

.email-input-wrapper input {
  padding-right: 50px;
}

.selected-sections-summary {
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid #e2e8f0;
}

.selected-sections-summary h4 {
  font-size: 12px;
  font-weight: 600;
  color: #64748b;
  margin: 0 0 10px 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.selected-sections-summary ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

.selected-sections-summary li {
  font-size: 13px;
  color: #334155;
  padding: 4px 0;
}

/* Output Configuration */
.output-config {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-bottom: 20px;
}

.output-row {
  display: flex;
  gap: 16px;
}

.output-group {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.output-label {
  font-size: 12px;
  font-weight: 600;
  color: #374151;
}

.output-input {
  padding: 10px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 13px;
  color: #334155;
}

.output-input:focus {
  outline: none;
  border-color: var(--ai-accent);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Pro Feature Badge */
.pro-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: white;
  font-size: 10px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 10px;
  text-transform: uppercase;
}

.pro-feature-card {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border: 1px solid #f59e0b;
  border-radius: 10px;
  padding: 16px;
  margin-top: 16px;
}

.pro-feature-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.pro-feature-icon {
  font-size: 24px;
}

.pro-feature-title {
  font-size: 14px;
  font-weight: 600;
  color: #92400e;
  margin: 0;
}

.pro-feature-desc {
  font-size: 12px;
  color: #78350f;
  line-height: 1.5;
  margin: 0 0 12px 0;
}

.pro-feature-btn {
  background: #f59e0b;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 8px 16px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s ease;
}

.pro-feature-btn:hover {
  background: #d97706;
}

/* Builder Navigation */
.builder-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 24px;
  padding-top: 20px;
  border-top: 1px solid #e2e8f0;
}

.builder-nav-left,
.builder-nav-right {
  display: flex;
  gap: 10px;
}

/* WYSIWYG Editor Modal */
.report-editor {
  display: grid;
  grid-template-columns: 1fr 240px;
  gap: 20px;
  min-height: 450px;
}

.editor-tabs {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 16px;
}

.editor-tab {
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 8px 14px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.editor-tab:hover {
  background: #e2e8f0;
}

.editor-tab.active {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
}

.editor-panels {
  flex: 1;
}

.editor-panel {
  display: none;
}

.editor-panel.active {
  display: block;
}

.editor-ai-sidebar {
  background: linear-gradient(135deg, var(--blue-900) 0%, var(--blue-500) 100%);
  border-radius: 12px;
  padding: 20px;
  color: white;
}

.editor-ai-sidebar h4 {
  font-size: 16px;
  font-weight: 600;
  margin: 0 0 16px 0;
}

.editor-ai-sidebar .ai-suggestions {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.editor-modal-content {
  min-height: 400px;
}

.editor-toolbar {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  padding: 10px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-bottom: none;
  border-radius: 8px 8px 0 0;
}

.editor-toolbar-btn {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 4px;
  padding: 6px 10px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.editor-toolbar-btn:hover {
  background: #f0f9ff;
  border-color: var(--ai-accent);
}

.editor-area {
  min-height: 300px;
  padding: 16px;
  border: 1px solid #e2e8f0;
  border-radius: 0 0 8px 8px;
  font-size: 14px;
  line-height: 1.6;
  outline: none;
}

.editor-area:focus {
  border-color: var(--ai-accent);
}

/* Quill Editor Overrides */
.ql-container {
  font-family: inherit;
  font-size: 14px;
}

.ql-editor {
  min-height: 280px;
  line-height: 1.6;
}

.ql-toolbar.ql-snow {
  border-radius: 8px 8px 0 0;
  background: #f8fafc;
}

.ql-container.ql-snow {
  border-radius: 0 0 8px 8px;
}

/* Dark Theme - Report Builder Wizard */
html.theme-dark .step-number {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
  color: var(--text-secondary);
}

html.theme-dark .progress-step:not(:last-child)::after {
  background: var(--border-color);
}

html.theme-dark .step-label {
  color: var(--text-muted);
}

html.theme-dark .step-title {
  color: var(--text-primary);
}

html.theme-dark .step-description {
  color: var(--text-secondary);
}

html.theme-dark .data-source-card {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .data-source-card:hover {
  background: rgba(59, 130, 246, 0.1);
  border-color: rgba(59, 130, 246, 0.3);
}

html.theme-dark .data-source-card.selected {
  background: rgba(59, 130, 246, 0.15);
  border-color: var(--ai-accent);
}

html.theme-dark .data-source-name {
  color: var(--text-primary);
}

html.theme-dark .data-source-desc {
  color: var(--text-secondary);
}

html.theme-dark .filter-label,
html.theme-dark .output-label {
  color: var(--text-secondary);
}

html.theme-dark .filter-select,
html.theme-dark .output-input {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .section-item {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .section-item:hover {
  background: rgba(59, 130, 246, 0.1);
  border-color: rgba(59, 130, 246, 0.3);
}

html.theme-dark .section-item.selected {
  background: rgba(59, 130, 246, 0.15);
  border-color: var(--ai-accent);
}

html.theme-dark .section-name {
  color: var(--text-primary);
}

html.theme-dark .section-desc {
  color: var(--text-secondary);
}

html.theme-dark .preview-main {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .preview-header {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .preview-title {
  color: var(--text-primary);
}

html.theme-dark .preview-content {
  background: var(--card-bg);
}

html.theme-dark .builder-nav {
  border-color: var(--border-color);
}

html.theme-dark .editor-toolbar {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .editor-toolbar-btn {
  background: var(--card-bg);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .editor-area {
  background: var(--card-bg);
  border-color: var(--border-color);
  color: var(--text-primary);
}

/* ========================================
   STEP 1: REPORT TYPE GRID & CARDS
   ======================================== */

.report-type-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 20px;
}

.report-type-card {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 14px 16px;
  background: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
  position: relative;
}

.report-type-card:hover {
  border-color: #bfdbfe;
  background: #f0f9ff;
}

.report-type-card.selected {
  border-color: var(--ai-accent);
  background: var(--blue-50);
}

.type-icon {
  font-size: 28px;
  line-height: 1;
  flex-shrink: 0;
}

.type-info {
  flex: 1;
  min-width: 0;
}

.type-name {
  font-size: 13px;
  font-weight: 600;
  color: #0f172a;
  margin-bottom: 2px;
  line-height: 1.3;
}

.type-desc {
  font-size: 11px;
  color: #64748b;
  line-height: 1.4;
}

.type-check {
  font-size: 16px;
  color: var(--ai-accent);
  font-weight: 700;
  flex-shrink: 0;
  width: 20px;
  text-align: center;
}

/* ========================================
   STEP 1: CLASSIFICATION OPTIONS
   ======================================== */

.classification-options {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.classification-option {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s ease;
  font-size: 13px;
}

.classification-option:hover {
  border-color: #bfdbfe;
  background: #f0f9ff;
}

.classification-option.selected {
  border-color: var(--ai-accent);
  background: var(--blue-50);
}

.classification-option input[type="radio"] {
  width: 16px;
  height: 16px;
  accent-color: var(--ai-accent);
  margin: 0;
}

.classification-option .option-label {
  font-weight: 500;
  color: #334155;
}

/* ========================================
   STEP 1: META BADGES (Data Source)
   ======================================== */

.source-meta {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}

.meta-badge {
  display: inline-block;
  background: #e2e8f0;
  color: #475569;
  font-size: 10px;
  font-weight: 500;
  padding: 2px 8px;
  border-radius: 10px;
}

/* ========================================
   STEP 3: SECTION GROUPS
   ======================================== */

.sections-container {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 8px;
}

.section-group {
  margin-bottom: 20px;
}

.section-group:last-child {
  margin-bottom: 0;
}

.section-group-title {
  font-size: 13px;
  font-weight: 600;
  color: #374151;
  margin: 0 0 10px 0;
  padding-bottom: 6px;
  border-bottom: 1px solid #e2e8f0;
}

/* ========================================
   STEP 4: REPORT SUMMARY CARD
   ======================================== */

.report-summary-card {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 20px;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #f1f5f9;
}

.summary-row:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

.summary-row:first-child {
  padding-top: 0;
}

.summary-label {
  font-size: 12px;
  font-weight: 500;
  color: #64748b;
}

.summary-value {
  font-size: 13px;
  font-weight: 600;
  color: #0f172a;
}

.classification-badge {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.classification-badge.public {
  background: #dcfce7;
  color: #16a34a;
}

.classification-badge.internal {
  background: var(--blue-100);
  color: var(--ai-accent-hover);
}

.classification-badge.confidential {
  background: #fef3c7;
  color: #d97706;
}

.classification-badge.restricted {
  background: #fee2e2;
  color: #dc2626;
}

/* ========================================
   STEP 4: SUMMARY SECTIONS
   ======================================== */

.summary-section {
  margin-bottom: 16px;
}

.summary-section:last-child {
  margin-bottom: 0;
}

.summary-section h4 {
  font-size: 12px;
  font-weight: 600;
  color: #374151;
  margin: 0 0 8px 0;
}

.summary-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.summary-list li {
  font-size: 12px;
  color: #475569;
  padding: 4px 0;
}

.summary-list li.empty {
  color: #94a3b8;
  font-style: italic;
}

/* ========================================
   STEP 4: SELECTION SUMMARY
   ======================================== */

.selection-summary {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 16px;
  background: #ecfdf5;
  border: 1px solid #a7f3d0;
  border-radius: 8px;
  margin-top: 16px;
}

.summary-icon {
  font-size: 18px;
}

.selection-summary span {
  font-size: 13px;
  color: #065f46;
  font-weight: 500;
}

/* ========================================
   STEP 4: PREVIEW CONTENT
   ======================================== */

.report-preview-content {
  padding: 20px;
}

.preview-report-header {
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid #e2e8f0;
}

.preview-report-header h2 {
  font-size: 18px;
  font-weight: 700;
  color: #0f172a;
  margin: 0 0 8px 0;
}

.preview-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 12px;
  color: #64748b;
}

.classification-tag {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
}

.classification-tag.public {
  background: #dcfce7;
  color: #16a34a;
}

.classification-tag.internal {
  background: var(--blue-100);
  color: var(--ai-accent-hover);
}

.classification-tag.confidential {
  background: #fef3c7;
  color: #d97706;
}

.classification-tag.restricted {
  background: #fee2e2;
  color: #dc2626;
}

.preview-stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-bottom: 20px;
}

.preview-stat-card {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 12px;
  text-align: center;
}

.preview-stat-card .stat-value {
  font-size: 24px;
  font-weight: 700;
  color: #0f172a;
}

.preview-stat-card .stat-label {
  font-size: 11px;
  color: #64748b;
  margin-top: 2px;
}

.preview-stat-card.critical .stat-value {
  color: #dc2626;
}

.preview-stat-card.success .stat-value {
  color: #16a34a;
}

.preview-sections {
  margin-bottom: 20px;
}

.preview-sections h4 {
  font-size: 14px;
  font-weight: 600;
  color: #374151;
  margin: 0 0 10px 0;
}

.preview-sections ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.preview-sections li {
  background: #f1f5f9;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  color: #475569;
}

.preview-note {
  background: #f8fafc;
  border: 1px dashed #cbd5e1;
  border-radius: 8px;
  padding: 12px 16px;
}

.preview-note p {
  margin: 0;
  font-size: 12px;
  color: #64748b;
  font-style: italic;
}

/* ========================================
   DARK THEME - NEW STEP 1 ELEMENTS
   ======================================== */

html.theme-dark .report-type-card {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .report-type-card:hover {
  background: rgba(59, 130, 246, 0.1);
  border-color: rgba(59, 130, 246, 0.3);
}

html.theme-dark .report-type-card.selected {
  background: rgba(59, 130, 246, 0.15);
  border-color: var(--ai-accent);
}

html.theme-dark .type-name {
  color: var(--text-primary);
}

html.theme-dark .type-desc {
  color: var(--text-secondary);
}

html.theme-dark .classification-option {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .classification-option:hover {
  background: rgba(59, 130, 246, 0.1);
  border-color: rgba(59, 130, 246, 0.3);
}

html.theme-dark .classification-option.selected {
  background: rgba(59, 130, 246, 0.15);
  border-color: var(--ai-accent);
}

html.theme-dark .classification-option .option-label {
  color: var(--text-primary);
}

html.theme-dark .meta-badge {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
}

html.theme-dark .section-group-title {
  color: var(--text-secondary);
  border-color: var(--border-color);
}

html.theme-dark .report-summary-card {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .summary-row {
  border-color: var(--border-color);
}

html.theme-dark .summary-label {
  color: var(--text-muted);
}

html.theme-dark .summary-value {
  color: var(--text-primary);
}

html.theme-dark .summary-section h4 {
  color: var(--text-secondary);
}

html.theme-dark .summary-list li {
  color: var(--text-secondary);
}

html.theme-dark .selection-summary {
  background: rgba(16, 185, 129, 0.1);
  border-color: rgba(16, 185, 129, 0.3);
}

html.theme-dark .selection-summary span {
  color: #34d399;
}

html.theme-dark .preview-report-header {
  border-color: var(--border-color);
}

html.theme-dark .preview-report-header h2 {
  color: var(--text-primary);
}

html.theme-dark .preview-meta {
  color: var(--text-secondary);
}

html.theme-dark .preview-stat-card {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .preview-stat-card .stat-value {
  color: var(--text-primary);
}

html.theme-dark .preview-stat-card .stat-label {
  color: var(--text-secondary);
}

html.theme-dark .preview-sections h4 {
  color: var(--text-secondary);
}

html.theme-dark .preview-sections li {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
}

html.theme-dark .preview-note {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .preview-note p {
  color: var(--text-muted);
}

/* Source Info Styles for Dark Theme */
html.theme-dark .source-info h4 {
  color: var(--text-primary);
}

html.theme-dark .source-info p {
  color: var(--text-secondary);
}

/* Dark Theme - Editor Panel */
html.theme-dark .builder-step-editor .editor-panel {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .builder-step-editor .editor-header {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .builder-step-editor .editor-header h4 {
  color: var(--text-primary);
}

html.theme-dark .editor-section-tabs {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .editor-tab {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
  color: var(--text-secondary);
}

html.theme-dark .editor-tab:hover {
  background: var(--bg-secondary);
}

html.theme-dark .editor-tab.active {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
}

html.theme-dark .editor-toolbar {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .editor-btn {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .editor-btn:hover {
  background: var(--bg-secondary);
}

html.theme-dark .toolbar-sep {
  background: var(--border-color);
}

html.theme-dark .editor-area {
  background: var(--card-bg);
  color: var(--text-primary);
}

html.theme-dark .builder-step-editor .preview-panel {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .builder-step-editor .preview-header {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .builder-step-editor .preview-header h4 {
  color: var(--text-primary);
}

html.theme-dark .builder-step-editor .preview-frame {
  background: var(--card-bg);
}

html.theme-dark .preview-section {
  border-color: var(--border-color);
}

html.theme-dark .preview-section h3 {
  color: var(--text-primary);
  border-color: var(--border-color);
}

html.theme-dark .preview-section-content {
  color: var(--text-secondary);
}

/* Responsive - Report Builder */
@media (max-width: 992px) {
  .builder-step.builder-step-editor.active {
    grid-template-columns: 1fr;
    min-height: auto;
  }

  .builder-step-editor .editor-panel,
  .builder-step-editor .preview-panel {
    min-height: 300px;
    max-height: none;
  }
}

@media (max-width: 768px) {
  .report-type-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .classification-options {
    flex-direction: column;
  }

  .preview-stats {
    grid-template-columns: repeat(2, 1fr);
  }

  .data-source-grid {
    grid-template-columns: 1fr;
  }

  .filter-grid {
    grid-template-columns: 1fr;
  }

  .preview-panel {
    flex-direction: column;
  }

  .ai-sidebar {
    width: 100%;
  }

  .output-row {
    flex-direction: column;
  }

  .builder-progress {
    overflow-x: auto;
    padding-bottom: 8px;
  }

  .progress-step {
    min-width: 70px;
  }

  .editor-section-tabs {
    flex-wrap: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .editor-tab {
    white-space: nowrap;
    flex-shrink: 0;
  }
}

/* ========================================
   REPORT BUILDER - TWO SCREEN LAYOUT
   Screen 1: Generate Report Modal
   Screen 2: Edit Content Modal
   ======================================== */

/* Screen 1: Generate Report Layout */
.report-generate-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  min-height: 500px;
}

.generate-config-panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
  max-height: 550px;
  overflow-y: auto;
  padding-right: 8px;
}

.config-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.config-label {
  font-size: 13px;
  font-weight: 600;
  color: #374151;
}

.config-value-display {
  padding: 10px 14px;
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  color: #0f172a;
}

/* Sections Checklist with Drag & Drop */
.sections-checklist {
  display: flex;
  flex-direction: column;
  gap: 6px;
  max-height: 240px;
  overflow-y: auto;
  padding: 12px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
}

.section-checklist-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  cursor: grab;
  transition: all 0.15s ease;
  overflow: visible;
}

.section-checklist-item:hover {
  border-color: #bfdbfe;
  background: #f0f9ff;
}

.section-checklist-item.dragging {
  opacity: 0.5;
  border-color: var(--ai-accent);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.section-checklist-item.drag-over {
  border-color: var(--ai-accent);
  background: var(--blue-50);
  transform: scale(1.02);
}

.drag-handle {
  color: #94a3b8;
  font-size: 14px;
  cursor: grab;
  padding: 2px 4px;
  user-select: none;
}

.drag-handle:hover {
  color: #64748b;
}

/* Locked Section Styles */
.section-locked {
  background: #fef3c7 !important;
  border-color: #fbbf24 !important;
  cursor: default !important;
}

.section-locked:hover {
  background: #fef3c7 !important;
  border-color: #fbbf24 !important;
}

.lock-icon {
  font-size: 14px;
  padding: 2px 4px;
  user-select: none;
  filter: grayscale(100%);
  opacity: 0.6;
}

.section-checklist-item .checkbox-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  cursor: pointer;
}

.section-checklist-item input[type="checkbox"] {
  width: 16px;
  height: 16px;
  accent-color: var(--ai-accent);
}

.section-checklist-item .section-name {
  font-size: 13px;
  color: #334155;
}

.section-actions {
  display: flex !important;
  gap: 6px;
  margin-left: auto;
  flex-shrink: 0;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.section-checklist-item:hover .section-actions {
  opacity: 1;
}

.btn-edit-section,
.btn-remove-section {
  display: inline-flex !important;
  align-items: center;
  justify-content: center;
  background: var(--ai-accent) !important;
  border: none !important;
  color: white !important;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  padding: 6px 12px;
  line-height: 1;
  transition: all 0.2s ease;
  border-radius: 5px;
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
  min-width: 32px;
  height: 32px;
}

.btn-edit-section {
  background: var(--ai-accent) !important;
}

.btn-remove-section {
  background: #ef4444 !important;
  box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
}

.btn-edit-section:hover {
  background: var(--ai-accent-hover) !important;
  transform: translateY(-1px);
  box-shadow: 0 4px 6px rgba(59, 130, 246, 0.4);
}

.btn-remove-section:hover {
  background: #dc2626 !important;
  transform: translateY(-1px);
  box-shadow: 0 4px 6px rgba(239, 68, 68, 0.4);
}

.btn-add-section {
  margin-top: 16px;
  width: 100%;
  background: #dc2626;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(220, 38, 38, 0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  letter-spacing: 0.3px;
}

.btn-add-section:hover {
  background: #b91c1c;
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(220, 38, 38, 0.35);
}

.btn-add-section:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(220, 38, 38, 0.3);
}

/* Section Modals */
.edit-section-modal,
.add-section-modal {
  padding: 8px 0;
}

/* .modal-description moved to core/components.css (Canonical) */

.section-examples {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px solid #e2e8f0;
}

.examples-label {
  font-size: 12px;
  font-weight: 600;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}

.example-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.example-chip {
  padding: 6px 12px;
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 16px;
  font-size: 13px;
  color: #475569;
  cursor: pointer;
  transition: all 0.2s ease;
}

.example-chip:hover {
  background: #e0e7ff;
  border-color: #818cf8;
  color: #4f46e5;
  transform: translateY(-1px);
}

/* ========================================
   STEP 4: PREVIEW & GENERATE
   ======================================== */

.preview-generate-layout {
  display: grid;
  grid-template-columns: 350px 1fr;
  gap: 24px;
  min-height: 500px;
}

/* Left Panel: Configuration */
.preview-config-panel {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 20px;
  height: fit-content;
}

.preview-config-panel .panel-title {
  margin: 0 0 16px 0;
  font-size: 16px;
  font-weight: 600;
  color: #1e293b;
}

.config-summary {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.summary-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.summary-label {
  font-size: 12px;
  font-weight: 600;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.summary-value {
  font-size: 14px;
  color: #0f172a;
  font-weight: 500;
}

.classification-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  width: fit-content;
}

.classification-badge.public {
  background: var(--blue-100);
  color: var(--blue-800);
}

.classification-badge.internal {
  background: #fef3c7;
  color: #92400e;
}

.classification-badge.confidential {
  background: #fee2e2;
  color: #991b1b;
}

/* Right Panel: Preview */
.preview-panel-wrapper {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  max-height: 600px;
}

.preview-panel-wrapper .panel-title {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: #1e293b;
  padding: 16px 20px;
  background: #f8fafc;
  border-bottom: 1px solid #e2e8f0;
}

.preview-content-area {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.preview-section {
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid #f1f5f9;
}

.preview-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.preview-section h3 {
  margin: 0 0 12px 0;
  font-size: 16px;
  font-weight: 600;
  color: #0f172a;
}

.preview-placeholder {
  font-size: 13px;
  color: #94a3b8;
  font-style: italic;
  margin: 0;
  padding: 12px 16px;
  background: #f8fafc;
  border-radius: 6px;
  border: 1px dashed #cbd5e1;
}

.preview-more {
  text-align: center;
  padding: 16px;
  background: #f8fafc;
  border-radius: 8px;
  margin-top: 16px;
}

.preview-more p {
  margin: 0;
  font-size: 14px;
  font-weight: 500;
  color: #64748b;
}

/* Sections List Preview */
.preview-sections-list {
  margin-top: 24px;
  padding-top: 24px;
  border-top: 2px solid #f1f5f9;
}

.sections-list-title {
  margin: 0 0 8px 0;
  font-size: 16px;
  font-weight: 600;
  color: #0f172a;
}

.sections-list-description {
  margin: 0 0 16px 0;
  font-size: 13px;
  color: #64748b;
  line-height: 1.5;
}

.sections-preview-ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.section-preview-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  transition: all 0.2s;
}

.section-preview-item:hover {
  background: #f1f5f9;
  border-color: #cbd5e1;
}

.section-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 700;
  color: #64748b;
  flex-shrink: 0;
}

.section-preview-name {
  font-size: 14px;
  font-weight: 500;
  color: #1e293b;
}

/* Table of Contents Styling */
.toc-list {
  margin-top: 24px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.toc-item {
  display: flex;
  align-items: baseline;
  gap: 8px;
  padding: 8px 0;
}

.toc-title {
  font-size: 15px;
  font-weight: 500;
  color: #1e293b;
  white-space: nowrap;
}

.toc-dots {
  flex: 1;
  border-bottom: 2px dotted #cbd5e1;
  margin: 0 8px;
  min-width: 40px;
}

.toc-page {
  font-size: 15px;
  font-weight: 600;
  color: #64748b;
  min-width: 30px;
  text-align: right;
}

/* Page Number Indicator (for edit mode) */
.report-page-indicator {
  position: sticky;
  top: 0;
  right: 20px;
  z-index: 100;
  background: var(--ai-accent);
  color: white;
  padding: 8px 16px;
  border-radius: 0 0 8px 8px;
  font-size: 13px;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  width: fit-content;
  margin-left: auto;
  margin-bottom: -40px;
}

/* Responsive */
@media (max-width: 1024px) {
  .preview-generate-layout {
    grid-template-columns: 1fr;
    gap: 20px;
  }

  .preview-config-panel {
    order: 2;
  }

  .preview-panel-wrapper {
    order: 1;
    max-height: 400px;
  }
}

/* Generate Preview Panel */
.generate-preview-panel {
  display: flex;
  flex-direction: column;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.preview-panel-header {
  padding: 14px 20px;
  background: white;
  border-bottom: 1px solid #e2e8f0;
}

.preview-panel-header h4 {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
}

.preview-panel-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  background: white;
}

/* Preview Report Styles */
.preview-report {
  font-size: 13px;
}

.preview-report .preview-report-header {
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid #e2e8f0;
}

.preview-report .preview-report-header h2 {
  font-size: 18px;
  font-weight: 700;
  color: #0f172a;
  margin: 0 0 8px 0;
}

.preview-report .preview-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 12px;
  color: #64748b;
}

.preview-stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  margin-bottom: 20px;
}

.preview-stat {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 12px;
  text-align: center;
}

.preview-stat .stat-value {
  font-size: 22px;
  font-weight: 700;
  color: #0f172a;
}

.preview-stat .stat-label {
  font-size: 11px;
  color: #64748b;
  margin-top: 2px;
}

.preview-stat.critical .stat-value {
  color: #dc2626;
}

.preview-stat.success .stat-value {
  color: #16a34a;
}

.preview-sections-list {
  background: #f8fafc;
  border-radius: 8px;
  padding: 14px;
}

.preview-sections-list h4 {
  font-size: 12px;
  font-weight: 600;
  color: #64748b;
  margin: 0 0 10px 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.preview-sections-list ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.preview-sections-list li {
  font-size: 13px;
  color: #334155;
  padding: 6px 10px;
  background: white;
  border-radius: 4px;
  border: 1px solid #e2e8f0;
}

/* Screen 2: Edit Content Layout */
.report-edit-layout {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
}

/* Top Bar with Section Dropdown and Toggle */
.edit-top-bar {
  display: flex !important;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  padding: 0 0 12px 0;
  margin-bottom: 12px;
  border-bottom: 2px solid #e2e8f0;
  flex-shrink: 0;
  background: white;
  position: relative;
  z-index: 100;
  min-height: 48px;
}

/* Section selector dropdown container */
.edit-section-selector {
  display: flex !important;
  align-items: center;
  flex-shrink: 0;
  margin-right: 16px;
  visibility: visible !important;
}

.section-dropdown {
  padding: 8px 12px;
  font-size: 14px;
  font-weight: 500;
  color: #1e293b;
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  outline: none;
  min-width: 250px;
}

.section-dropdown:hover {
  border-color: #cbd5e1;
}

.section-dropdown:focus {
  border-color: var(--ai-accent);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Hide old tabs bar (replaced by dropdown) */
.edit-tabs-bar {
  display: none;
}

.view-mode-toggle {
  display: flex;
  gap: 0;
  background: #f1f5f9;
  border-radius: 8px;
  padding: 4px;
  flex-shrink: 0;
}

.toggle-btn {
  padding: 8px 16px;
  background: transparent;
  border: none;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  color: #64748b;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.toggle-btn:hover {
  color: var(--ai-accent);
}

.toggle-btn.active {
  background: white;
  color: var(--ai-accent);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.edit-tab {
  padding: 8px 16px;
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
  color: #475569;
  cursor: pointer;
  transition: all 0.15s ease;
  white-space: nowrap;
}

.edit-tab:hover {
  background: #e2e8f0;
  border-color: #cbd5e1;
}

.edit-tab.active {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
}

.edit-main-area {
  flex: 1;
  display: flex;
  overflow: hidden;
  min-height: 0;
  position: relative;
  margin-top: 0;
  /* Allow flexbox to shrink properly */
}

/* Editor Panel */
.edit-editor-panel {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100%;
  flex-direction: column;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  overflow: hidden;
  background: white;
  z-index: 2;
  display: flex;
  /* Full width, controlled by JS display property */
}

/* Removed duplicate preview panel styles - see lines 4973+ for active styles */

/* Logo watermark at bottom left of every page */
.page-watermark {
  position: absolute;
  bottom: 30px;
  left: 60px;
  pointer-events: none;
  user-select: none;
  z-index: 10;
}

.page-watermark img {
  max-height: 40px;
  max-width: 150px;
  opacity: 0.6;
}

/* Page number at bottom right */
.page-number-footer {
  position: absolute;
  bottom: 30px;
  right: 60px;
  font-size: 11px;
  font-weight: 500;
  color: #64748b;
  z-index: 10;
}

.page-number-badge {
  position: absolute;
  top: 20px;
  right: 20px;
  background: var(--ai-accent);
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
  display: none;
}

.page-content {
  font-size: 14px;
  line-height: 1.8;
  color: #1e293b;
  position: relative;
  z-index: 5;
}

/* ========================================
   PAGE-SAFE LAYOUT RULES
   Professional pagination for reports
   ======================================== */

/* Rule 1: Headings must stay with their content */
.page-content h1,
.page-content h2,
.page-content h3,
.page-content h4 {
  page-break-after: avoid;
  break-after: avoid-page;
  page-break-inside: avoid;
  break-inside: avoid;
}

.page-content h2 {
  margin-top: 0;
  margin-bottom: 16px;
  font-size: 24px;
  color: #0f172a;
}

/* Rule 2: Keep heading with first paragraph */
.page-content h2 + p,
.page-content h3 + p,
.page-content h2 + ul,
.page-content h2 + ol,
.page-content h2 + table,
.page-content h2 + .chart-container,
.page-content h2 + .risk-heatmap,
.page-content h2 + .recommendations-grid {
  page-break-before: avoid;
  break-before: avoid-page;
}

.page-content p {
  margin-bottom: 12px;
}

.page-content ul,
.page-content ol {
  margin-bottom: 16px;
  padding-left: 24px;
  page-break-inside: avoid;
  break-inside: avoid;
}

.page-content li {
  margin-bottom: 8px;
}

/* Rule 3: Page-safe block components - never split across pages */
.page-content table,
.page-content .chart-container,
.page-content .risk-heatmap,
.page-content .risk-heatmap-container,
.page-content .recommendations-grid,
.page-content .recommendation-card,
.page-content .kpi-card,
.page-content .summary-card,
.page-content .metric-card,
.page-content canvas,
.page-content figure,
.page-content .data-visualization {
  page-break-inside: avoid;
  break-inside: avoid;
  page-break-before: auto;
  break-before: auto;
}

/* Rule 4: Tables - keep header with content */
.page-content table {
  page-break-inside: avoid;
  break-inside: avoid;
}

.page-content thead {
  display: table-header-group;
}

.page-content tbody {
  page-break-inside: avoid;
  break-inside: avoid;
}

/* Rule 5: Section markers - prefer page breaks before major sections */
.page-content .section-break,
.page-content [data-section-start] {
  page-break-before: always;
  break-before: page;
}

/* Rule 6: Prevent orphans and widows in text */
.page-content p {
  orphans: 3;
  widows: 3;
}

/* ========================================
   PRINT MEDIA QUERIES
   Enforce pagination rules during PDF export
   ======================================== */
@media print {
  /* Force page-safe rules in print mode */
  .page-content h1,
  .page-content h2,
  .page-content h3,
  .page-content h4 {
    page-break-after: avoid !important;
    page-break-inside: avoid !important;
  }

  /* Block components must not split */
  .page-content table,
  .page-content .chart-container,
  .page-content .risk-heatmap,
  .page-content .risk-heatmap-container,
  .page-content .recommendations-grid,
  .page-content .recommendation-card,
  .page-content .kpi-card,
  .page-content canvas,
  .page-content figure {
    page-break-inside: avoid !important;
  }

  /* Keep headings with their following content */
  .page-content h2 + p,
  .page-content h2 + ul,
  .page-content h2 + ol,
  .page-content h2 + table,
  .page-content h2 + .chart-container,
  .page-content h2 + .risk-heatmap {
    page-break-before: avoid !important;
  }

  /* Standard page margins for professional documents */
  @page {
    margin: 2.5cm 2cm;
    size: A4;
  }

  /* Page counter for "Page X of Y" */
  @page {
    @bottom-right {
      content: "Page " counter(page) " of " counter(pages);
      font-size: 10pt;
      color: #64748b;
    }
  }

  /* Prevent text orphans/widows */
  p {
    orphans: 3 !important;
    widows: 3 !important;
  }

  /* Hide edit-mode page guides in print */
  .page-guide,
  .large-component-warning::after {
    display: none !important;
  }

  /* Tables: Repeat header row on each page */
  table {
    page-break-inside: avoid !important;
  }

  thead {
    display: table-header-group !important;
  }

  tbody {
    display: table-row-group !important;
  }

  /* Ensure backgrounds print */
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
  }
}

/* ========================================
   EDIT MODE - PAGE BOUNDARY GUIDES
   Visual feedback for pagination while editing
   ======================================== */

.editor-content-area {
  flex: 1;
  min-height: 400px;
  padding: 20px;
  font-size: 14px;
  line-height: 1.7;
  overflow-y: auto;
  outline: none;
  background: white;
  position: relative;

  /* Subtle page boundary markers every ~11 inches (A4 height) */
  background-image:
    linear-gradient(to bottom,
      transparent 0px,
      transparent calc(29.7cm - 1px),
      rgba(99, 102, 241, 0.08) calc(29.7cm - 1px),
      rgba(99, 102, 241, 0.08) calc(29.7cm + 40px),
      transparent calc(29.7cm + 40px)
    );
  background-repeat: repeat-y;
  background-size: 100% 29.7cm;
}

.editor-content-area:focus {
  background-color: #fafbfc;
}

/* Page boundary guide labels */
.editor-content-area::before {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  height: 100%;
  pointer-events: none;
  z-index: 1;
}

/* Page number guide overlay */
.page-guide {
  position: relative;
  height: 40px;
  margin: 0 -20px;
  padding: 0 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(to bottom, rgba(99, 102, 241, 0.05), transparent);
  border-top: 1px dashed rgba(99, 102, 241, 0.2);
  border-bottom: 1px dashed rgba(99, 102, 241, 0.2);
  color: #6366f1;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  user-select: none;
  pointer-events: none;
  opacity: 0.6;
}

.page-guide::before {
  content: ' ';
}

.page-guide::after {
  content: ' ';
}

/* ========================================
   OVERFLOW WARNINGS
   Alert users when components may move to next page
   ======================================== */

/* Warning for large components that might not fit */
.editor-content-area .large-component-warning {
  border: 2px dashed #fbbf24 !important;
  background: rgba(251, 191, 36, 0.05) !important;
  position: relative;
}

.editor-content-area .large-component-warning::after {
  content: ' This component may move to the next page';
  position: absolute;
  top: -24px;
  left: 0;
  background: #fef3c7;
  color: #92400e;
  padding: 4px 10px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  white-space: nowrap;
  pointer-events: none;
  z-index: 10;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Highlight for charts, tables, and other block components in edit mode */
.editor-content-area table,
.editor-content-area .chart-container,
.editor-content-area .risk-heatmap,
.editor-content-area canvas {
  border: 1px solid rgba(99, 102, 241, 0.1);
  padding: 8px;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.editor-content-area table:hover,
.editor-content-area .chart-container:hover,
.editor-content-area .risk-heatmap:hover {
  border-color: rgba(99, 102, 241, 0.3);
  background: rgba(99, 102, 241, 0.02);
}

.edit-editor-panel .editor-toolbar {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 4px;
  padding: 10px 12px;
  background: #f8fafc;
  border-bottom: 1px solid #e2e8f0;
}

.toolbar-select {
  padding: 7px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
  background: white;
  color: #475569;
  cursor: pointer;
  transition: all 0.15s ease;
  outline: none;
}

.toolbar-select:hover {
  border-color: #cbd5e1;
  background: #f8fafc;
}

.toolbar-select:focus {
  border-color: var(--ai-accent);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.toolbar-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 7px 10px;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  color: #475569;
  cursor: pointer;
  transition: all 0.15s ease;
  min-width: 34px;
  height: 34px;
  text-align: center;
}

.toolbar-btn:hover {
  background: #f1f5f9;
  border-color: #cbd5e1;
  color: #1e293b;
}

.toolbar-btn:active {
  background: #e2e8f0;
  transform: scale(0.96);
}

.toolbar-btn.active {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
}

.toolbar-btn svg {
  width: 16px;
  height: 16px;
}

.toolbar-divider {
  width: 1px;
  height: 24px;
  background: linear-gradient(180deg, transparent, #e2e8f0, transparent);
  margin: 0 8px;
}

.editor-content-area {
  flex: 1;
  min-height: 0;
  padding: 16px 20px;
  font-size: 14px;
  line-height: 1.7;
  overflow-y: auto;
  outline: none;
}

.modal-fullscreen .editor-content-area {
  min-height: 0;
  /* Allow flex to control height for proper scrolling */
}

.editor-content-area:focus {
  box-shadow: inset 0 0 0 2px rgba(59, 130, 246, 0.15);
}

.editor-content-area h2 {
  font-size: 18px;
  color: #1e293b;
  margin: 0 0 12px 0;
  padding-bottom: 8px;
  border-bottom: 1px solid #e2e8f0;
}

.editor-content-area p {
  margin: 10px 0;
  color: #334155;
}

.editor-content-area ul,
.editor-content-area ol {
  margin: 10px 0;
  padding-left: 28px;
  color: #334155;
}

.editor-content-area ul {
  list-style-type: disc !important;
}

.editor-content-area ul ul {
  list-style-type: circle !important;
}

.editor-content-area ol {
  list-style-type: decimal !important;
}

.editor-content-area ol ol {
  list-style-type: lower-alpha !important;
}

.editor-content-area li {
  margin: 6px 0;
  display: list-item !important;
  color: #334155;
}

.editor-content-area li::marker {
  color: #475569;
}

/* Preview Panel */
.edit-preview-panel {
  display: flex;
  flex-direction: column;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  overflow: hidden;
  background: #f8fafc;
}

.edit-preview-header {
  padding: 12px 16px;
  background: white;
  border-bottom: 1px solid #e2e8f0;
}

.edit-preview-header h4 {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
}

.edit-preview-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  background: white;
  min-height: 0;
  max-height: none;
  /* Remove max-height restriction to allow preview to fill space */
}

.modal-fullscreen .edit-preview-content {
  min-height: 0;
  /* Allow flex to control height for proper scrolling */
}

.preview-section-rendered {
  font-size: 13px;
  line-height: 1.7;
  color: #334155;
}

.preview-section-rendered h2 {
  font-size: 16px;
  color: #1e293b;
  margin: 0 0 12px 0;
  padding-bottom: 8px;
  border-bottom: 1px solid #e2e8f0;
}

.preview-section-rendered p {
  margin: 8px 0;
}

.preview-section-rendered ul,
.preview-section-rendered ol {
  margin: 8px 0;
  padding-left: 20px;
}

.preview-section-rendered li {
  margin: 4px 0;
}

/* .form-textarea MOVED TO core/components.css (Canonical) */

/* Responsive for Two-Screen Layout */
@media (max-width: 992px) {
  .report-generate-layout {
    grid-template-columns: 1fr;
    gap: 20px;
  }

  .generate-config-panel {
    max-height: none;
  }

  .generate-preview-panel {
    max-height: 400px;
  }

  .edit-main-area {
    grid-template-columns: 1fr;
  }

  .edit-editor-panel,
  .edit-preview-panel {
    min-height: 300px;
  }

  .preview-stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .edit-tabs-bar {
    flex-wrap: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    max-height: none;
    padding-bottom: 12px;
  }

  .edit-tab {
    flex-shrink: 0;
  }

  .preview-stats-grid {
    grid-template-columns: 1fr 1fr;
  }
}

/* Dark Theme - Report Builder Two-Screen */
html.theme-dark .config-value-display {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .sections-checklist {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .section-checklist-item {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .section-checklist-item:hover {
  background: rgba(59, 130, 246, 0.1);
  border-color: rgba(59, 130, 246, 0.3);
}

html.theme-dark .section-checklist-item .section-name {
  color: var(--text-primary);
}

html.theme-dark .drag-handle {
  color: var(--text-muted);
}

html.theme-dark .section-locked {
  background: rgba(251, 191, 36, 0.15) !important;
  border-color: rgba(251, 191, 36, 0.4) !important;
}

html.theme-dark .section-locked:hover {
  background: rgba(251, 191, 36, 0.15) !important;
  border-color: rgba(251, 191, 36, 0.4) !important;
}

html.theme-dark .generate-preview-panel {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .preview-panel-header {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .preview-panel-header h4 {
  color: var(--text-primary);
}

html.theme-dark .preview-panel-content {
  background: var(--card-bg);
}

html.theme-dark .preview-report .preview-report-header h2 {
  color: var(--text-primary);
}

html.theme-dark .preview-report .preview-meta {
  color: var(--text-secondary);
}

html.theme-dark .preview-stat {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .preview-stat .stat-value {
  color: var(--text-primary);
}

html.theme-dark .preview-stat .stat-label {
  color: var(--text-secondary);
}

html.theme-dark .preview-sections-list {
  background: var(--bg-tertiary);
}

html.theme-dark .preview-sections-list h4 {
  color: var(--text-muted);
}

html.theme-dark .preview-sections-list li {
  background: var(--card-bg);
  border-color: var(--border-color);
  color: var(--text-primary);
}

/* ========================================
   EDIT REPORT MODAL - SIMPLE WORKING LAYOUT
   ========================================
   Base modal-fullscreen styles are in base-modal.css
   Only report-specific extensions here */

.report-edit-layout {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.edit-top-bar {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  gap: 16px;
  padding-bottom: 16px;
  margin-bottom: 16px;
  border-bottom: 2px solid #e2e8f0;
  flex-shrink: 0;
}

.edit-main-area {
  flex: 1;
  position: relative;
  overflow: hidden;
}

.edit-editor-panel,
.edit-preview-panel {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.editor-content-area {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  min-height: 500px;
}

.preview-page-indicator {
  position: sticky;
  top: 0;
  z-index: 10;
  background: rgba(37, 41, 46, 0.95);
  color: white;
  padding: 12px 20px;
  text-align: center;
  font-size: 13px;
  font-weight: 600;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(8px);
  flex-shrink: 0;
}

.preview-pages-container {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 24px;
  align-items: center;
  background: #525659;
  min-height: 0;
}

.preview-page {
  width: 100%;
  max-width: 800px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  padding: 60px;
  min-height: 297mm;
  /* A4 height: 297mm */
  max-height: 297mm;
  position: relative;
  page-break-after: always;
  break-after: page;
  overflow: hidden;
  /* Prevent content from overflowing page boundaries */
  box-sizing: border-box;
}

.page-content {
  font-size: 14px;
  line-height: 1.8;
  color: #1e293b;
  max-height: calc(297mm - 180px);
  /* Reserve space for padding, watermark, and page numbers */
  overflow: hidden;
  position: relative;
  z-index: 1;
}

@media print {
  .preview-pages-container {
    padding: 0;
    background: white;
  }

  .preview-page {
    box-shadow: none;
    border-radius: 0;
    page-break-after: always;
  }

  @page {
    margin: 2.5cm 2cm;
    size: A4;
  }
}

/* Dark theme support */
html.theme-dark .modal-fullscreen .modal-footer {
  background: var(--card-bg) !important;
  border-top-color: var(--border-color) !important;
}

html.theme-dark .edit-tabs-bar {
  border-color: var(--border-color);
}

html.theme-dark .edit-tab {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
  color: var(--text-secondary);
}

html.theme-dark .edit-tab:hover {
  background: var(--bg-secondary);
}

html.theme-dark .edit-tab.active {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
}

html.theme-dark .edit-editor-panel {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .edit-editor-panel .editor-toolbar {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .toolbar-select {
  background: var(--card-bg);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .toolbar-select:hover {
  background: var(--bg-secondary);
  border-color: var(--border-color);
}

html.theme-dark .toolbar-select:focus {
  border-color: var(--ai-accent);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
}

html.theme-dark .toolbar-btn {
  background: var(--card-bg);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .toolbar-btn:hover {
  background: var(--bg-secondary);
  border-color: rgba(59, 130, 246, 0.3);
}

html.theme-dark .toolbar-btn.active {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
}

html.theme-dark .toolbar-divider {
  background: linear-gradient(180deg, transparent, var(--border-color), transparent);
}

html.theme-dark .editor-content-area {
  color: var(--text-primary);
}

html.theme-dark .editor-content-area h2 {
  color: var(--text-primary);
  border-color: var(--border-color);
}

html.theme-dark .editor-content-area p {
  color: var(--text-secondary);
}

html.theme-dark .edit-preview-panel {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .edit-preview-header {
  background: var(--card-bg);
  border-color: var(--border-color);
}

html.theme-dark .edit-preview-header h4 {
  color: var(--text-primary);
}

html.theme-dark .edit-preview-content {
  background: var(--card-bg);
}

html.theme-dark .preview-section-rendered {
  color: var(--text-secondary);
}

html.theme-dark .preview-section-rendered h2 {
  color: var(--text-primary);
  border-color: var(--border-color);
}

html.theme-dark .form-textarea {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .config-label {
  color: var(--text-secondary);
}

/* ========================================
   FIX: Edit Content Modal Layout
   Ensure side-by-side editor and preview display correctly
   ======================================== */

/* Allow modal-xl to show side-by-side content */
.modal-xl .modal-body {
  overflow: visible;
  overflow-y: auto;
  max-height: calc(90vh - 140px);
}

/* REMOVED - These rules were breaking the layout */

/* ========================================
   REPORT KEBAB MENU (Vertical 3-dot menu)
   ======================================== */

.report-kebab-wrapper {
  position: relative;
  display: inline-block;
  z-index: 1;
}

.report-kebab-wrapper:has(.report-kebab-dropdown.visible) {
  z-index: 9999;
}

.report-kebab-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  background: transparent;
  border: 1px solid transparent;
  border-radius: 6px;
  color: #64748b;
  cursor: pointer;
  transition: all 0.15s ease;
}

.report-kebab-btn:hover {
  background: #f1f5f9;
  color: #334155;
  border-color: #e2e8f0;
}

.report-kebab-btn.active {
  background: #f1f5f9;
  color: #c41e3a;
  border-color: #e2e8f0;
}

.report-kebab-btn svg {
  width: 18px;
  height: 18px;
}

/* Kebab Dropdown Menu */
.report-kebab-dropdown {
  position: absolute;
  top: calc(100% + 4px);
  right: 0;
  min-width: 180px;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 2px 10px rgba(0, 0, 0, 0.1);
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-8px) scale(0.95);
  transform-origin: top right;
  transition: all 0.2s ease;
}

.report-kebab-dropdown.visible {
  opacity: 1;
  visibility: visible;
  transform: translateY(0) scale(1);
}

/* Dropdown positioned above trigger (when near bottom of viewport) */
.report-kebab-dropdown.dropdown-up {
  transform-origin: bottom right;
  animation: kebabSlideUp 0.15s ease;
}

@keyframes kebabSlideUp {
  from {
    opacity: 0;
    transform: translateY(8px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.kebab-menu-item {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  padding: 10px 14px;
  background: transparent;
  border: none;
  font-size: 13px;
  font-weight: 500;
  color: #334155;
  cursor: pointer;
  text-align: left;
  transition: all 0.15s ease;
}

.kebab-menu-item:hover {
  background: #f8fafc;
  color: #0f172a;
}

.kebab-menu-item svg {
  width: 16px;
  height: 16px;
  color: #64748b;
  flex-shrink: 0;
}

.kebab-menu-item:hover svg {
  color: #334155;
}

/* Danger item (Delete) */
.kebab-menu-item.danger {
  color: #dc2626;
}

.kebab-menu-item.danger:hover {
  background: #fef2f2;
  color: #b91c1c;
}

.kebab-menu-item.danger svg {
  color: #dc2626;
}

.kebab-menu-item.danger:hover svg {
  color: #b91c1c;
}

/* Divider in kebab menu */
.kebab-menu-divider {
  height: 1px;
  background: #e2e8f0;
  margin: 4px 0;
}

/* Update report card actions to include kebab */
.report-card-actions {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Recent report row - add kebab positioning */
.recent-report-row .report-actions {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Dark Theme - Kebab Menu */
html.theme-dark .report-kebab-btn {
  color: var(--text-secondary);
}

html.theme-dark .report-kebab-btn:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  border-color: var(--border-color);
}

html.theme-dark .report-kebab-btn.active {
  background: var(--bg-tertiary);
  color: #c41e3a;
  border-color: var(--border-color);
}

html.theme-dark .report-kebab-dropdown {
  background: var(--card-bg);
  border-color: var(--border-color);
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
}

html.theme-dark .kebab-menu-item {
  color: var(--text-primary);
}

html.theme-dark .kebab-menu-item:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

html.theme-dark .kebab-menu-item svg {
  color: var(--text-secondary);
}

html.theme-dark .kebab-menu-divider {
  background: var(--border-color);
}

html.theme-dark .kebab-menu-item.danger:hover {
  background: rgba(220, 38, 38, 0.1);
}

/* ========================================
   RENAME MODAL INPUT
   ======================================== */

.rename-input-wrapper {
  margin-top: 12px;
}

.rename-input {
  width: 100%;
  padding: 12px 14px;
  font-size: 14px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  background: white;
  color: #0f172a;
  transition: all 0.15s ease;
}

.rename-input:focus {
  outline: none;
  border-color: #c41e3a;
  box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.1);
}

html.theme-dark .rename-input {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
  color: var(--text-primary);
}

/* ========================================
   SHARE MODAL STYLES - REMOVED (orphaned - no JS uses these classes)
   ~90 lines deleted
   ======================================== */

/* ========================================
   PDF EXPORT MODAL STYLES
   ======================================== */

.pdf-export-config {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.pdf-export-config .config-section {
  background: #f8fafc;
  border-radius: 12px;
  padding: 20px;
  border: 1px solid #e2e8f0;
}

.config-section-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
}

.config-section-icon {
  font-size: 18px;
}

.config-section-title {
  font-size: 15px;
  font-weight: 600;
  color: #0f172a;
}

.config-section-body {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.config-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.config-field {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.config-field .config-label {
  font-size: 13px;
  font-weight: 500;
  color: #374151;
}

.format-display {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  color: #0f172a;
}

.format-icon {
  font-size: 16px;
}

/* Toggle Buttons */
.btn-group-toggle {
  display: flex;
  gap: 8px;
}

.btn-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 13px;
  color: #64748b;
  cursor: pointer;
  transition: all 0.15s ease;
}

.btn-toggle:hover {
  border-color: #c41e3a;
  color: #c41e3a;
}

.btn-toggle.active {
  background: #c41e3a;
  border-color: #c41e3a;
  color: white;
}

.btn-group-sm .btn-toggle {
  padding: 6px 12px;
}

/* Logo Upload */
.logo-upload-box {
  border: 2px dashed #e2e8f0;
  border-radius: 10px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.15s ease;
  background: white;
  min-height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.logo-upload-box:hover {
  border-color: #c41e3a;
  background: #fef2f2;
}

.logo-upload-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.logo-upload-icon {
  font-size: 24px;
  opacity: 0.6;
}

.logo-upload-text {
  font-size: 12px;
  color: #94a3b8;
}

/* Logo Position Grid */
.logo-position-grid {
  display: flex;
  gap: 8px;
}

.position-btn {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 16px;
  color: #64748b;
  cursor: pointer;
  transition: all 0.15s ease;
}

.position-btn:hover {
  border-color: #c41e3a;
  color: #c41e3a;
}

.position-btn.active {
  background: #c41e3a;
  border-color: #c41e3a;
  color: white;
}

/* Checkbox Grid */
.config-checkbox-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.config-checkbox {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 13px;
  color: #374151;
  cursor: pointer;
  transition: all 0.15s ease;
}

.config-checkbox:hover {
  border-color: #c41e3a;
}

.config-checkbox input[type="checkbox"] {
  width: 16px;
  height: 16px;
  accent-color: #c41e3a;
}

/* Dark Theme */
html.theme-dark .pdf-export-config .config-section {
  background: var(--bg-tertiary);
  border-color: var(--border-color);
}

html.theme-dark .config-section-title {
  color: var(--text-primary);
}

html.theme-dark .config-field .config-label {
  color: var(--text-secondary);
}

html.theme-dark .format-display,
html.theme-dark .btn-toggle,
html.theme-dark .logo-upload-box,
html.theme-dark .position-btn,
html.theme-dark .config-checkbox {
  background: var(--bg-secondary);
  border-color: var(--border-color);
  color: var(--text-primary);
}

html.theme-dark .btn-toggle.active,
html.theme-dark .position-btn.active {
  background: #c41e3a;
  border-color: #c41e3a;
  color: white;
}

/* Responsive */
@media (max-width: 768px) {
  .config-row {
    grid-template-columns: 1fr;
  }

  .config-checkbox-grid {
    grid-template-columns: 1fr;
  }
}

/* ========================================
   PDF EXPORT PROGRESS MODAL
   ======================================== */

.export-progress-container {
  text-align: center;
  padding: 30px 20px;
}

.export-progress-content,
.export-complete-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
}

.export-icon-wrapper {
  margin-bottom: 8px;
}

.export-icon-circle {
  width: 72px;
  height: 72px;
  border-radius: 50%;
  background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  animation: exportIconPulse 2s ease-in-out infinite;
  transition: transform 0.15s ease, background 0.3s ease;
}

.export-icon-circle svg {
  color: #475569;
  transition: color 0.3s ease;
}

.export-icon-circle.success {
  background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
  animation: exportIconSuccess 0.5s ease-out forwards;
}

.export-icon-circle.success svg {
  color: #16a34a;
}

@keyframes exportIconPulse {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(196, 30, 58, 0.2);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 0 0 15px rgba(196, 30, 58, 0);
  }
}

@keyframes exportIconSuccess {
  0% {
    transform: scale(0.8);
    opacity: 0;
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.export-progress-title {
  font-size: 18px;
  font-weight: 600;
  color: #0f172a;
  margin: 0;
}

.export-progress-title.success {
  color: #16a34a;
}

.export-progress-subtitle {
  font-size: 14px;
  color: #64748b;
  margin: 0;
}

.export-progress-bar-container {
  width: 100%;
  max-width: 280px;
}

.export-progress-bar {
  height: 8px;
  background: #e2e8f0;
  border-radius: 4px;
  overflow: hidden;
}

.export-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #c41e3a 0%, #e11d48 50%, #c41e3a 100%);
  background-size: 200% 100%;
  border-radius: 4px;
  width: 0;
  transition: width 0.5s ease-out;
  animation: progressShimmer 1.5s linear infinite;
}

@keyframes progressShimmer {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

.export-progress-status {
  font-size: 13px;
  color: #64748b;
  margin: 0;
  min-height: 20px;
  transition: opacity 0.3s ease;
}

/* Dark theme support */
html.theme-dark .export-progress-container {
  color: var(--text-primary);
}

html.theme-dark .export-icon-circle {
  background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
}

html.theme-dark .export-icon-circle svg {
  color: var(--text-secondary);
}

html.theme-dark .export-icon-circle.success {
  background: linear-gradient(135deg, rgba(22, 163, 74, 0.2) 0%, rgba(22, 163, 74, 0.1) 100%);
}

html.theme-dark .export-progress-title {
  color: var(--text-primary);
}

html.theme-dark .export-progress-bar {
  background: var(--bg-tertiary);
}

html.theme-dark .export-progress-status,
html.theme-dark .export-progress-subtitle {
  color: var(--text-secondary);
}

/* Inline Edit Popup Overlay */
.inline-edit-popup {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.inline-edit-popup.active {
  opacity: 1;
}

.inline-popup-content {
  background: white;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 0 1px rgba(0, 0, 0, 0.1);
  max-width: 540px;
  width: 90%;
  max-height: 90vh;
  overflow: hidden;
  animation: popupSlideIn 0.3s ease-out;
}

@keyframes popupSlideIn {
  from {
    transform: translateY(-20px) scale(0.95);
    opacity: 0;
  }
  to {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}

.inline-popup-header {
  padding: 24px 24px 20px 24px;
  border-bottom: 1px solid #f3f4f6;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: linear-gradient(to bottom, #ffffff 0%, #fafbfc 100%);
}

.inline-popup-header span {
  font-size: 20px;
  font-weight: 600;
  color: #111827;
  display: flex;
  align-items: center;
  gap: 10px;
}

.inline-popup-close {
  background: transparent;
  border: none;
  font-size: 28px;
  color: #9ca3af;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  transition: all 0.2s;
  line-height: 1;
}

.inline-popup-close:hover {
  background: #f3f4f6;
  color: #374151;
}

.inline-popup-body {
  padding: 24px;
  overflow-y: auto;
  max-height: calc(90vh - 180px);
}

.inline-popup-description {
  font-size: 14px;
  color: #6b7280;
  margin: 0 0 16px 0;
  line-height: 1.5;
}

.inline-popup-input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 15px;
  transition: all 0.2s;
  font-family: inherit;
}

.inline-popup-input:focus {
  outline: none;
  border-color: var(--ai-accent);
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
}

.inline-popup-input::placeholder {
  color: #9ca3af;
}

.inline-popup-chips {
  margin-top: 20px;
}

.chips-label {
  font-size: 13px;
  font-weight: 600;
  color: #374151;
  margin: 0 0 12px 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.suggestion-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.chip-btn {
  display: inline-flex;
  align-items: center;
  padding: 8px 14px;
  background: #f9fafb;
  border: 1.5px solid #e5e7eb;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
  color: #374151;
  cursor: pointer;
  transition: all 0.2s;
}

.chip-btn:hover {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.25);
}

.chip-btn:active {
  transform: translateY(0);
}

.inline-popup-footer {
  padding: 16px 24px;
  border-top: 1px solid #f3f4f6;
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  background: #fafbfc;
}

.inline-popup-footer .btn {
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  border: none;
}

.inline-popup-footer .btn-secondary {
  background: white;
  color: #374151;
  border: 1.5px solid #e5e7eb;
}

.inline-popup-footer .btn-secondary:hover {
  background: #f9fafb;
  border-color: #d1d5db;
}

.inline-popup-footer .btn-primary {
  background: var(--ai-accent);
  color: white;
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
}

.inline-popup-footer .btn-primary:hover {
  background: var(--ai-accent-hover);
  box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
  transform: translateY(-1px);
}

.inline-popup-footer .btn-primary:active {
  transform: translateY(0);
}

/* Dark theme support for Step 4: Preview & Generate */
html.theme-dark .preview-generate-layout {
  color: var(--text-primary);
}

html.theme-dark .preview-config-panel {
  background: var(--bg-tertiary);
  border-color: var(--border-primary);
}

html.theme-dark .preview-config-panel .panel-title {
  color: var(--text-primary);
}

html.theme-dark .summary-label {
  color: var(--text-secondary);
}

html.theme-dark .summary-value {
  color: var(--text-primary);
}

html.theme-dark .preview-panel-wrapper {
  background: var(--bg-secondary);
  border-color: var(--border-primary);
}

html.theme-dark .preview-panel-wrapper .panel-title {
  background: var(--bg-tertiary);
  border-color: var(--border-primary);
  color: var(--text-primary);
}

html.theme-dark .preview-content-area {
  background: var(--bg-secondary);
}

html.theme-dark .preview-section {
  border-color: var(--border-primary);
}

html.theme-dark .preview-section h3 {
  color: var(--text-primary);
}

html.theme-dark .preview-placeholder {
  background: var(--bg-tertiary);
  border-color: var(--border-primary);
  color: var(--text-secondary);
}

html.theme-dark .preview-more {
  background: var(--bg-tertiary);
}

html.theme-dark .preview-more p {
  color: var(--text-secondary);
}

html.theme-dark .preview-sections-list {
  border-top-color: var(--border-primary);
}

html.theme-dark .sections-list-title {
  color: var(--text-primary);
}

html.theme-dark .sections-list-description {
  color: var(--text-secondary);
}

html.theme-dark .section-preview-item {
  background: var(--bg-tertiary);
  border-color: var(--border-primary);
}

html.theme-dark .section-preview-item:hover {
  background: var(--bg-hover);
  border-color: var(--border-secondary);
}

html.theme-dark .section-number {
  background: var(--bg-secondary);
  border-color: var(--border-primary);
  color: var(--text-secondary);
}

html.theme-dark .section-preview-name {
  color: var(--text-primary);
}

html.theme-dark .toc-title {
  color: var(--text-primary);
}

html.theme-dark .toc-dots {
  border-bottom-color: var(--border-primary);
}

html.theme-dark .toc-page {
  color: var(--text-secondary);
}

html.theme-dark .report-page-indicator {
  background: var(--primary);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

/* Dark theme support for inline popups */
html.theme-dark .inline-popup-content {
  background: var(--bg-secondary);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 1px rgba(255, 255, 255, 0.1);
}

html.theme-dark .inline-popup-header {
  border-bottom-color: var(--border-primary);
  background: linear-gradient(to bottom, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
}

html.theme-dark .inline-popup-header span {
  color: var(--text-primary);
}

html.theme-dark .inline-popup-close {
  color: var(--text-secondary);
}

html.theme-dark .inline-popup-close:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

html.theme-dark .inline-popup-description {
  color: var(--text-secondary);
}

html.theme-dark .inline-popup-input {
  background: var(--bg-tertiary);
  border-color: var(--border-primary);
  color: var(--text-primary);
}

html.theme-dark .inline-popup-input:focus {
  border-color: var(--ai-accent);
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
}

html.theme-dark .inline-popup-input::placeholder {
  color: var(--text-tertiary);
}

html.theme-dark .chips-label {
  color: var(--text-primary);
}

html.theme-dark .chip-btn {
  background: var(--bg-tertiary);
  border-color: var(--border-primary);
  color: var(--text-primary);
}

html.theme-dark .chip-btn:hover {
  background: var(--ai-accent);
  border-color: var(--ai-accent);
  color: white;
}

html.theme-dark .inline-popup-footer {
  border-top-color: var(--border-primary);
  background: var(--bg-tertiary);
}

html.theme-dark .inline-popup-footer .btn-secondary {
  background: var(--bg-secondary);
  color: var(--text-primary);
  border-color: var(--border-primary);
}

html.theme-dark .inline-popup-footer .btn-secondary:hover {
  background: var(--bg-hover);
  border-color: var(--border-secondary);
}

/* ========================================
   COVER PAGE STYLES
   ======================================== */

.cover-page {
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  min-height: 1100px;
  position: relative;
  overflow: hidden;
}

.cover-watermark {
  position: absolute;
  bottom: 30px;
  left: 60px;
  pointer-events: none;
  user-select: none;
  z-index: 10;
}

.cover-watermark img {
  max-height: 40px;
  max-width: 150px;
  opacity: 0.6;
}

.cover-content {
  text-align: center;
  z-index: 10;
  max-width: 600px;
  padding: 40px;
  margin-top: -80px;
}

.cover-logo {
  display: none;
}

.cover-title {
  font-size: 48px;
  font-weight: 800;
  color: #0f172a;
  margin: 0 0 20px 0;
  line-height: 1.2;
  letter-spacing: -0.5px;
}

.cover-subtitle {
  font-size: 18px;
  font-weight: 500;
  color: #64748b;
  margin-bottom: 40px;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.cover-divider {
  width: 120px;
  height: 4px;
  background: linear-gradient(90deg, transparent, #dc2626, transparent);
  margin: 40px auto;
  border-radius: 2px;
}

.cover-details {
  margin-top: 60px;
  text-align: left;
  background: white;
  padding: 32px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  border: 1px solid #e2e8f0;
}

.cover-detail-item {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #f1f5f9;
}

.cover-detail-item:last-child {
  border-bottom: none;
}

.cover-detail-label {
  font-size: 13px;
  font-weight: 600;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.cover-detail-value {
  font-size: 14px;
  font-weight: 600;
  color: #1e293b;
}

.cover-footer {
  margin-top: 50px;
  display: flex;
  justify-content: center;
}

.cover-classification {
  display: inline-block;
  padding: 8px 24px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 1.5px;
}

.cover-classification.confidential {
  background: #fee2e2;
  color: #991b1b;
  border: 2px solid #dc2626;
}

.cover-classification.internal {
  background: #fef3c7;
  color: #92400e;
  border: 2px solid #f59e0b;
}

.cover-classification.public {
  background: var(--blue-100);
  color: var(--blue-900);
  border: 2px solid var(--ai-accent);
}

/* Dark theme for cover page */
html.theme-dark .cover-page {
  background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
}

html.theme-dark .cover-title {
  color: #f1f5f9;
}

html.theme-dark .cover-subtitle {
  color: #94a3b8;
}

html.theme-dark .cover-details {
  background: #1e293b;
  border-color: #334155;
}

html.theme-dark .cover-detail-item {
  border-bottom-color: #334155;
}

html.theme-dark .cover-detail-label {
  color: #94a3b8;
}

html.theme-dark .cover-detail-value {
  color: #e2e8f0;
}

/* Dark theme for page watermark */
html.theme-dark .page-watermark img,
html.theme-dark .cover-watermark img {
  opacity: 0.4;
}

/* ========================================
   STEP 2: DATA SOURCE SELECTION
   ======================================== */

/* Data Section Container */
.data-section {
  margin-bottom: 32px;
  padding: 24px;
  background: #ffffff;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  transition: all 0.2s ease;
}

.data-section:hover {
  border-color: #cbd5e1;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.data-section-title {
  font-size: 18px;
  font-weight: 700;
  color: #0f172a;
  margin: 0 0 8px 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.data-section-title .section-subtitle {
  font-size: 14px;
  font-weight: 400;
  color: #64748b;
  margin-left: 4px;
}

.data-section-desc {
  font-size: 14px;
  color: #64748b;
  margin: 0 0 20px 0;
}

/* Register Dropdown Container */
.register-dropdown-container {
  margin-top: 16px;
}

.register-dropdown {
  width: 100%;
  max-width: 500px;
  padding: 12px 16px;
  font-size: 15px;
  font-weight: 500;
  color: #1e293b;
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s ease;
  outline: none;
}

.register-dropdown:hover {
  border-color: #cbd5e1;
}

.register-dropdown:focus {
  border-color: var(--ai-accent);
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
}

/* Selection Grid */
.register-selection-grid,
.controls-selection-grid,
.kri-selection-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 16px;
  margin-top: 16px;
}

/* Hide register selection grid (replaced by dropdown) */
.register-selection-grid {
  display: none;
}

/* Selection Cards */
.selection-card {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 16px;
  background: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.selection-card:hover {
  background: #f1f5f9;
  border-color: #cbd5e1;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.selection-card.selected {
  background: var(--blue-50);
  border-color: var(--ai-accent);
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
}

.selection-card.selected:hover {
  background: var(--blue-100);
  border-color: var(--ai-accent-hover);
}

/* Card Checkbox/Radio */
.card-checkbox {
  flex-shrink: 0;
  padding-top: 2px;
}

.card-checkbox input[type="checkbox"],
.card-checkbox input[type="radio"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  accent-color: var(--ai-accent);
}

/* Card Content */
.card-content {
  flex: 1;
  min-width: 0;
}

.card-title {
  font-size: 15px;
  font-weight: 600;
  color: #0f172a;
  margin: 0 0 8px 0;
  line-height: 1.4;
  word-wrap: break-word;
}

.card-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

.card-meta > span {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 500;
  border-radius: 6px;
  white-space: nowrap;
}

/* Register Card Specific */
.register-card .register-risk-count {
  background: #f1f5f9;
  color: #475569;
  border: 1px solid #cbd5e1;
}

.register-card .risk-score {
  padding: 4px 10px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.register-card .risk-score.critical {
  background: #fee2e2;
  color: #991b1b;
  border: 1px solid #fca5a5;
}

.register-card .risk-score.high {
  background: #fed7aa;
  color: #9a3412;
  border: 1px solid #fdba74;
}

/* Control Card Specific */
.control-card .control-effectiveness {
  background: #ecfdf5;
  color: #065f46;
  border: 1px solid #86efac;
}

.control-card .control-type {
  background: #f1f5f9;
  color: #475569;
  border: 1px solid #cbd5e1;
}

/* KRI Card Specific */
.kri-card .kri-trend {
  padding: 4px 10px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 11px;
  text-transform: uppercase;
}

.kri-card .kri-trend.improving {
  background: #dcfce7;
  color: #166534;
  border: 1px solid #86efac;
}

.kri-card .kri-trend.stable {
  background: #e0f2fe;
  color: #075985;
  border: 1px solid #7dd3fc;
}

.kri-card .kri-trend.declining {
  background: #fee2e2;
  color: #991b1b;
  border: 1px solid #fca5a5;
}

.kri-card .kri-value {
  background: #f1f5f9;
  color: #475569;
  border: 1px solid #cbd5e1;
  font-weight: 600;
}

/* Empty States */
.empty-state,
.empty-state-info {
  padding: 40px 20px;
  text-align: center;
  color: #64748b;
  font-size: 14px;
  background: #f8fafc;
  border: 2px dashed #cbd5e1;
  border-radius: 10px;
}

.empty-state-info {
  padding: 24px 20px;
  font-style: italic;
}

/* Selection Summary Box */
.selection-summary-box {
  display: flex;
  gap: 16px;
  padding: 20px 24px;
  background: linear-gradient(135deg, var(--blue-500) 0%, var(--blue-600) 100%);
  border-radius: 12px;
  margin-top: 32px;
  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.25);
}

.selection-summary-box .summary-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
  text-align: center;
  padding: 12px;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 8px;
  backdrop-filter: blur(10px);
}

.selection-summary-box .summary-label {
  font-size: 12px;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.85);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.selection-summary-box .summary-count {
  font-size: 32px;
  font-weight: 700;
  color: #ffffff;
  line-height: 1;
}

/* Dark Theme for Data Selection */
html.theme-dark .data-section {
  background: #1e293b;
  border-color: #334155;
}

html.theme-dark .data-section:hover {
  border-color: #475569;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

html.theme-dark .data-section-title {
  color: #f1f5f9;
}

html.theme-dark .data-section-desc {
  color: #94a3b8;
}

html.theme-dark .selection-card {
  background: #0f172a;
  border-color: #334155;
}

html.theme-dark .selection-card:hover {
  background: #1e293b;
  border-color: #475569;
}

html.theme-dark .selection-card.selected {
  background: #1e3a8a;
  border-color: var(--ai-accent);
}

html.theme-dark .selection-card.selected:hover {
  background: #1e40af;
}

html.theme-dark .card-title {
  color: #f1f5f9;
}

html.theme-dark .empty-state,
html.theme-dark .empty-state-info {
  background: #0f172a;
  border-color: #334155;
  color: #94a3b8;
}

/* Responsive Design */
@media (max-width: 768px) {
  .register-selection-grid,
  .controls-selection-grid,
  .kri-selection-grid {
    grid-template-columns: 1fr;
  }

  .selection-summary-box {
    flex-direction: column;
    gap: 12px;
  }

  .data-section {
    padding: 16px;
  }
}

/* ========================================
   CHART IMPORT & ACTIONS
   ======================================== */

/* Add Chart Button - Enterprise Blue */
.toolbar-btn-add-chart {
  background: var(--ai-accent);
  color: white;
  border-radius: 8px;
  padding: 8px 12px;
  transition: all 0.2s ease;
  border: none;
}

.toolbar-btn-add-chart:hover {
  background: var(--ai-accent-hover);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
}

.toolbar-btn-add-chart svg {
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
}

/* Import Chart Modal Grid */
.import-chart-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
  padding: 4px;
}

.import-chart-card {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px;
  background: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  transition: all 0.2s ease;
}

.import-chart-card:hover {
  border-color: #cbd5e1;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  transform: translateY(-2px);
}

.chart-preview-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 80px;
  background: #ffffff;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.chart-preview-placeholder svg {
  color: #94a3b8;
}

.chart-info {
  flex: 1;
}

.chart-name {
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
  margin-bottom: 4px;
}

.chart-meta {
  font-size: 12px;
  color: #64748b;
}

/* Inserted Chart in Editor */
.inserted-chart {
  margin: 20px 0;
  padding: 16px;
  background: #ffffff;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  position: relative;
  cursor: pointer;
  transition: all 0.2s ease;
}

.inserted-chart:hover {
  border-color: var(--ai-accent);
  box-shadow: 0 4px 16px rgba(37, 99, 235, 0.15);
}

.chart-placeholder {
  margin-bottom: 12px;
  border-radius: 8px;
  overflow: hidden;
}

.chart-caption {
  font-size: 13px;
  color: #64748b;
  text-align: center;
  font-style: italic;
  padding: 8px;
  background: #f8fafc;
  border-radius: 6px;
}

/* Chart Action Overlay */
.chart-action-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  gap: 8px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.98);
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  border: 1px solid #e2e8f0;
  z-index: 100;
  animation: fadeSlideIn 0.2s ease;
}

@keyframes fadeSlideIn {
  from {
    opacity: 0;
    transform: translate(-50%, -45%);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%);
  }
}

.chart-action-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 10px 16px;
  font-size: 13px;
  font-weight: 500;
  color: #475569;
  background: #f8fafc;
  border: 1px solid #cbd5e1;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.chart-action-btn:hover {
  background: #e0e7ff;
  border-color: #818cf8;
  color: #4f46e5;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2);
}

.chart-action-btn svg {
  flex-shrink: 0;
}

.chart-action-btn-danger {
  color: #dc2626;
}

.chart-action-btn-danger:hover {
  background: #fee2e2;
  border-color: #fca5a5;
  color: #991b1b;
  box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
}

/* Chart Insights Panel */
.chart-insights-panel {
  padding: 8px;
}

.insight-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid #e2e8f0;
}

.insight-icon {
  font-size: 32px;
}

.insight-header h3 {
  margin: 0;
  font-size: 20px;
  color: #0f172a;
}

.insight-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
  margin-bottom: 20px;
}

.insight-item {
  padding: 12px;
  background: #f8fafc;
  border-radius: 8px;
  font-size: 14px;
  color: #475569;
}

.insight-item strong {
  display: block;
  color: #0f172a;
  margin-bottom: 4px;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.insight-recommendations {
  padding: 16px;
  background: linear-gradient(135deg, var(--blue-50) 0%, var(--blue-100) 100%);
  border-radius: 10px;
  border: 1px solid var(--blue-200);
}

.insight-recommendations h4 {
  margin: 0 0 12px 0;
  font-size: 15px;
  color: var(--blue-800);
}

.insight-recommendations ul {
  margin: 0;
  padding-left: 20px;
  color: var(--blue-900);
  font-size: 14px;
  line-height: 1.6;
}

.insight-recommendations li {
  margin-bottom: 8px;
}

/* Expanded Chart View */
.expanded-chart-view {
  padding: 8px;
}

/* Dark Theme for Charts */
html.theme-dark .import-chart-card {
  background: #0f172a;
  border-color: #334155;
}

html.theme-dark .import-chart-card:hover {
  border-color: #475569;
}

html.theme-dark .chart-preview-placeholder {
  background: #1e293b;
  border-color: #334155;
}

html.theme-dark .chart-name {
  color: #f1f5f9;
}

html.theme-dark .chart-meta {
  color: #94a3b8;
}

html.theme-dark .inserted-chart {
  background: #1e293b;
  border-color: #334155;
}

html.theme-dark .inserted-chart:hover {
  border-color: var(--ai-accent);
}

html.theme-dark .chart-caption {
  background: #0f172a;
  color: #94a3b8;
}

html.theme-dark .chart-action-overlay {
  background: rgba(30, 41, 59, 0.98);
  border-color: #475569;
}

html.theme-dark .chart-action-btn {
  background: #1e293b;
  border-color: #475569;
  color: #cbd5e1;
}

html.theme-dark .chart-action-btn:hover {
  background: #312e81;
  border-color: #818cf8;
  color: #c7d2fe;
}

html.theme-dark .insight-header {
  border-bottom-color: #334155;
}

html.theme-dark .insight-header h3 {
  color: #f1f5f9;
}

html.theme-dark .insight-item {
  background: #0f172a;
  color: #cbd5e1;
}

html.theme-dark .insight-item strong {
  color: #f1f5f9;
}

html.theme-dark .insight-recommendations {
  background: linear-gradient(135deg, #1e293b 0%, var(--blue-900) 100%);
  border-color: #3730a3;
}

html.theme-dark .insight-recommendations h4 {
  color: #93c5fd;
}

html.theme-dark .insight-recommendations ul {
  color: #bfdbfe;
}

/* ========================================
   AI THINKING MODAL - REMOVED (Dead Code)
   ~212 lines removed - these classes were never used:
   .ai-thinking-container, .ai-thinking-brain, .brain-icon, .brain-pulse,
   .ai-thinking-title, .ai-thinking-stages, .ai-stage, .ai-stage-dot,
   .ai-stage-text, .ai-thinking-prompt, @keyframes pulse-expand,
   @keyframes brain-glow, @keyframes dot-pulse
   Use features/ai-ui.css for AI thinking UI instead
   ======================================== */
